define("mui/zebra-hotspot-feed/mods/news",function(e,t,i){e("mui/kissy-polyfill/index");var a=e("mui/zepto/zepto");var r=e("mui/mtop/index");var n=e("mui/xtemplate/index");var o=e("mui/datalazyload/index");var s=e("mui/zebra-hotspot-feed/mods/time");var u=e("mui/countdown/index");var m=e("mui/datalazylist/index");var l=e("mui/crossimage/index");var d=e("mui/zepto/event");var c=e("mui/dlp/index");var f=new n(a("#feedNews").html());var p=new n(a("#feedMsg").html());var v=new n(a("#feedAlbum").html());var h=new n(a("#feedDaren").html());var w=a("#news_config_data").html();w=w&&JSON.parse(w);w=w||[];var g=w[0]&&w[0].shopAlbum||8;var z=w[0]&&w[0].darenAlbum||5;var b=w[0]&&w[0].overTime||"";var y=s.dateStrToStamp(b)-1e3;var T=function x(e){var t=(""+e).split("?")[1]||"";var i=t.split("#")[1];t=t.split("#")[0];t=t.split("&");var r={};a.each(t,function(e,t){var i=t.split("=");if(i[1]){r[i[0]]=decodeURIComponent(""+i[1])}});if(!r.hash){r.hash=i}return r};var D={loadNews:function k(e,t,i){var a="";for(var n in e){if(e.hasOwnProperty(n)&&e[n]!=="NO"){a+=","+e[n]}}a=a.substr(1);r.config.subDomain="m";c.mtop({dataType:"mtop",mtop:{api:"mtop.taobao.aladdin.service.tmall.redian",v:"1.0",ecode:0,data:{appId:a,pageSize:3,count:3}},cacheExpiryTime:24*60*60*1e3,localCacheType:"localStorage",error:function o(e,t,a){i(e);return},success:function u(a,r,n){var o=a.data&&a.data.resultValue;var u={};if(!o){i(a);return}for(var m in e){if(e.hasOwnProperty(m)){var l=o[e[m]];if(!l){continue}if(l.serverTime){s.setRecentTimeDiff(-new Date+ +l.serverTime)}if(l.exposureParam){(function(e){setTimeout(function(){(new Image).src=e},2e3)})(l.exposureParam)}u[m]=l}}t(u)},complete:function m(e,t,i){}})},formatData:function N(e,t){var i=T(window.location.href);var a=e.length;var r=s.serverNow();for(var n=0;n<a;n++){if(e[n].id){e[n].bizId=e[n].id}if(e[n].ID){e[n].bizId=e[n].ID}e[n].renderTime=s.dateStrToStamp(e[n].postTime||+e[n].time);if(e[n].stickStart&&e[n].stickEnd){e[n].stickStartTime=s.dateStrToStamp(e[n].stickStart);e[n].stickEndTime=s.dateStrToStamp(e[n].stickEnd)}if(e[n].renderTime&&e[n].renderTime<=y){e[n].overTimeFlag=true}if(e[n].renderTime&&e[n].renderTime>r){e[n].futureFlag=true}if(t==="sale"||t==="money"){if(e[n].time){e[n].eventTime=s.dateStrToStamp(e[n].time);if(r-e[n].eventTime>10*60*1e3){e[n].overTimeFlag=true}}}if(t==="chat"){if(e[n].pic2&&!e[n].imgSize){var o=/-(\d*)-(\d*).(jpg|png)/gi.exec(e[n].pic2);if(o&&o[1]&&o[2]){e[n].ratio=o[2]/o[1]*100}else{e[n].ratio=50}}if(e[n].imgSize){var u=e[n].imgSize.split("x");if(u[0]&&u[1]){e[n].ratio=u[0]/u[1]*100}}if(e[n].ratio){e[n].wRatio=28.5*100/e[n].ratio}}e[n].renderType=t}return e},hideMsg:function I(){},renderMsg:function C(e){},renderPcMsg:function S(e){},renderError:function A(){},immediatelyRenderNews:function E(e,t){var i=this;if(!t){t=".j_newsList"}var r=o.instance();r.addStartListener(l.DatalazyPlugin(a(t),{quality:"q90"}));e=e||[];e=i.filterData(e);var n=e.length;if(n>20){i.immediatelyRenderNews(e.splice(0,20),t);setTimeout(function(){i.immediatelyRenderNews(e,t)},1e3);return""}var s=i.renderNews(e,t);var u=a(s);i.countDown(u);a(t).append(u);r.addElements(u)},datalazylistRenderNews:function q(e,t,i){window.console&&console.log("before render time "+ +new Date);var r=this;if(!t){t=".j_newsList"}e=r.filterData(e);var n=o.instance();n.addStartListener(l.DatalazyPlugin(a(t),{quality:"q90"}));window.console&&console.log("render start time "+ +new Date);var s=T(window.location.href);var u=new m({render:new m.NodeRender({el:t,groupSize:8,scrollBuffer:8,createDom:function d(e){var t=e.item;var o=r.renderNews([t]);var s=r.renderAlbum(e.index,i);o=s+o;var u=a('<div data-index="'+e.index+'" class="listItem">'+o+"</div>");r.countDown(u);setTimeout(function(){n.addElements(u)},500);return u}}),loader:new m.StaticDataLoader(e)})},countDown:function L(e){if(!e){return}var t=a(e).find(".J-countdown");t.each(function(e,t){var i=a(t);if(i.hasClass("countdown-action")){return}else{i.addClass("countdown-action")}new u(i,{format:"{m1}{m2}:{s1}{s2}",timeToDouble:false,autoFormat:false}).when([{time:0,fun:function r(e){this.stop();a(this.container).removeClass("hurry").addClass("end");this.container.html("\u8fdb\u884c\u4e2d")}}])});var i=a(".J-countdown-later");i.each(function(e,t){var i=a(t);if(i.hasClass("countdown-action2")){return}else{i.addClass("countdown-action2")}var r=i[0].dataset.diff;new u(i,{format:"",timeToDouble:false,autoFormat:false}).when([{time:+r,fun:function n(e){a(this.container).addClass("hurry");this.config.format="{m1}{m2}:{s1}{s2}"}},{time:0,fun:function o(e){this.stop();a(this.container).removeClass("hurry").addClass("end");this.container.html("\u8fdb\u884c\u4e2d")}}])})},renderNews:function F(e){var t=this;e=e||[];var i=e.length;if(!e.length){return""}var r=function o(e){var t={"\u7f6e\u9876":"#EE0A3B","\u70ed\u70b9\u4e3b\u64ad":"#F5A623","\u70ed\u70b9\u8c0d\u62a5":"#32899E","\u53cc\u5341\u4e00\u4e3b\u4f1a\u573a":"#EE0A3B","\u53cc11\u4e3b\u4f1a\u573a":"#EE0A3B","\u73e0\u5b9d\u70ed\u70b9":"#DA00C1","\u5b55\u5a74\u70ed\u70b9":"#E45453","\u6e38\u620f\u70b9\u5361":"#89DA00","\u978b\u5c65\u70ed\u70b9":"#832EDD","\u7bb1\u5305\u70ed\u70b9":"#7028FF","\u6d17\u62a4\u70ed\u70b9":"#0C78CB","\u73a9\u5177\u70ed\u70b9":"#00DA71","\u56fe\u4e66\u97f3\u50cf":"#C56E6E","\u6570\u7801\u70ed\u70b9":"#2964DD","\u53cc11\u70ed\u70b9":"#FF2100","\u751f\u6d3b\u70ed\u70b9":"#FF7A00","\u751f\u6d3b\u670d\u52a1":"#F5A623","\u6c7d\u8f66\u70ed\u70b9":"#5227DD","\u914d\u9970\u70ed\u70b9":"#DD2965","\u65c5\u884c\u70ed\u70b9":"#3AA9FF","\u65c5\u6e38\u70ed\u70b9":"#3AA9FF","\u96f6\u98df\u70ed\u70b9":"#54C719","\u6559\u80b2\u70ed\u70b9":"#52BEFF","\u5bb6\u88c5\u70ed\u70b9":"#A00001","\u5bb6\u5c45\u70ed\u70b9":"#B1501F","\u6237\u5916\u70ed\u70b9":"#0CC9C1","\u4e2a\u6027\u5b9a\u5236":"#505050","\u4e2a\u62a4\u70ed\u70b9":"#C40066","\u670d\u9970\u70ed\u70b9":"#FF1A42","\u7535\u5668\u70ed\u70b9":"#0042C9","\u529e\u516c\u70ed\u70b9":"#007FDE","\u5929\u732b\u56fd\u9645":"#7A3CE9"};return t[e]||"#EE0A3B"};var n=f.render({data:e,formatTime:s.formatTime,formatCountDown:s.formatCountDown,tagColor:r,eh:function u(e){if(e){e=e.replace(/^http:|^https:/,"")}return e}});n=a.trim(n);return n},renderAlbum:function R(e,t){if(!t){return""}var i=t.shopAlbumContentList;var r=t.darenAlbumContentList;if(e===g-1){var n=v.render({list:i&&i.slice(0,3),eh:function o(e){if(e){e=e.replace(/^http:|^https:/,"")}return e}});n=a.trim(n);return n}if(e===z-1){var n=h.render({list:r&&r.slice(0,3),eh:function s(e){if(e){e=e.replace(/^http:|^https:/,"")}return e}});n=a.trim(n);return n}return""},sortData:function P(e){window.console&&console.log("sort start "+ +new Date);var t=this;var i=T(window.location.href);var a=[];var r=[];var n=s.serverNow();var o=e.zebra&&t.formatData(e.zebra,"news")||[];var u=e.setTop&&e.setTop.data||[];var m=i["syncIds"];if(m){if(Object.prototype.toString.call(m)==="[object Array]"){m=m[0]}u=[{ID:m}].concat(u)}var l=u.length;var d=e.news&&e.news.data&&t.formatData(e.news.data,"news")||[];var c=d.length;window.console&&console.log("sort1 start "+ +new Date);var f=e.sale&&e.sale.data&&t.formatData(e.sale.data,"sale")||[];var p=f.length;window.console&&console.log("sort2 start "+ +new Date);var v=e.money&&e.money.data&&t.formatData(e.money.data,"money")||[];var h=v.length;window.console&&console.log("sort3 start "+ +new Date);var w=e.chat&&e.chat.data&&t.formatData(e.chat.data,"chat")||[];var g=w.length;window.console&&console.log("sort4 start "+ +new Date);var z=e.album&&e.album.data&&t.formatData(e.album.data,"album")||[];var b=z.length;window.console&&console.log("sort5 start "+ +new Date);var y=e.shopAlbumContent&&e.shopAlbumContent.data||[];var D=e.darenAlbumContent&&e.darenAlbumContent.data||[];window.console&&console.log("sort6 start "+ +new Date);for(var x=0;x<o.length;x++){o[x].setTop=true}a=a.concat(o);window.console&&console.log("sort7 start "+ +new Date);for(var k=0;k<l;k++){var N=false;if(u[k].endTime&&n>s.dateStrToStamp(u[k].endTime)){continue}if(u[k].startTime&&n<s.dateStrToStamp(u[k].startTime)){continue}for(var I=0;I<c;I++){if(d[I].bizId===u[k].ID){d[I].setTop=true;a.push(d.splice(I,1)[0]);c--;N=true;break}}if(N){continue}for(var C=0;C<p;C++){if(f[C].bizId===u[k].ID){f[C].setTop=true;a.push(f.splice(C,1)[0]);p--;N=true;break}}if(N){continue}for(var S=0;S<h;S++){if(v[S].bizId===u[k].ID){v[S].setTop=true;a.push(v.splice(S,1)[0]);h--;N=true;break}}if(N){continue}for(var A=0;A<g;A++){if(w[A].bizId===u[k].ID){w[A].setTop=true;a.push(w.splice(A,1)[0]);g--;N=true;break}}if(N){continue}}window.console&&console.log("sort8 start "+ +new Date);r=r.concat(d,f,v,w);r=r.sort(function(e,t){if(e.renderTime!==t.renderTime){return-e.renderTime+t.renderTime}else{if(e.bizId>t.bizId){return 1}else{return-1}}});window.console&&console.log("sort9 start "+ +new Date);for(var E=0,q=r.length;E<q;E++){var L=r[E];if(L.stickStartTime&&L.stickEndTime){if(L.stickStartTime<=n&&L.stickEndTime>=n){L.setTop=true;a.push(r.splice(E,1)[0]);q--}}}window.console&&console.log("sort10 start "+ +new Date);return{topRenderList:a,normalRenderList:r,shopAlbumContentList:y,darenAlbumContentList:D}},filterData:function _(e){for(var t=e.length-1;t>=0;t--){if(e[t].entityType==="ACTIVITY"||e[t].entityType==="ITEM"){e.splice(t,1)}else if(e[t].futureFlag||e[t].overTimeFlag){e.splice(t,1)}else if(e[t].linktype&&e[t].linktype+""!==window._linkType+""){e.splice(t,1)}else if(e[t].offlineTime){if(s.serverNow()>s.dateStrToStamp(e[t].offlineTime)){e.splice(t,1)}}}return e},compareNews:function J(e,t){var i=this;var a=i.filterData(e.topRenderList);var r=i.filterData(e.normalRenderList);var n=i.filterData(t.topRenderList);var o=i.filterData(t.normalRenderList);var s=a.length;var u=r.length;var m=n.length;var l=o.length;var d;var c=false;for(d=0;d<s;d++){if(d>3){break}if(a[d].bizId!==n[d].bizId){c=true;break}}if(c){return true}for(d=0;d<u;d++){if(d>3){break}if(r[d].bizId!==o[d].bizId){c=true;break}}if(c){return true}return false}};i.exports=D});