define("mui/zebra-chaoshi-rec-pro-list/page",["mui/zepto/touch","mui/chaoshi-ald/index","mui/pull-to-request/index","mui/custom-event/index","mui/chaoshi-item-plugins/cross-lazyload","mui/chaoshi-item/index-column.xtpl","mui/prompt/indicator/index","mui/chaoshi-item/index"],function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(e,o.key,o)}}return function(t,n,o){if(n)e(t.prototype,n);if(o)e(t,o);return t}}();var r=function e(t,n,o){if(t===null)t=Function.prototype;var r=Object.getOwnPropertyDescriptor(t,n);if(r===undefined){var i=Object.getPrototypeOf(t);if(i===null){return undefined}else{return e(i,n,o)}}else if("value"in r){return r.value}else{var a=r.get;if(a===undefined){return undefined}return a.call(o)}};function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("mui/zepto/touch");var c=e("mui/chaoshi-ald/index");var l=e("mui/pull-to-request/index");var d=e("mui/custom-event/index");var f=e("mui/chaoshi-item-plugins/cross-lazyload");var h=e("mui/chaoshi-item/index-column.xtpl");var p=e("mui/prompt/indicator/index");var m=e("mui/chaoshi-item/index");window._CTK3d8e=window._CTK3d8e||function(){var e={},t="",n=0;function o(e){var t=0,n,o,r;if(e.length===0)return t;for(n=0,r=e.length;n<r;n++){o=e.charCodeAt(n);t=(t<<5)-t+o;t|=0}return t}var r=+new Date;window.spyTrack=function(e,t){var i="undefined"+n++,a=window[i]=new Image;a.onload=a.onerror=function(){window[i]=null};var u=["type=normal","name="+encodeURIComponent(e),"parent=","module=1059","msg="+encodeURIComponent(t||""),"version=1.0.0","sample=1","time="+(+new Date-r)].join("&");a.src="//gm.mmstat.com/tmjs.1.1?"+u+"&hash="+o(u)};return function(r,i,a,u){u=u||{};if(u.reject){if(typeof u.reject!="object"){u.reject=[u.reject]}for(var s=u.reject.length-1;s>=0;s--){if(e[u.reject[s]]){return}}}if(!t){t=i}var c=(new Date).valueOf();e[i]=c;var l;if(i==t){var d=window.g_config&&g_config.startTime;l=d?c-d:0}else{l=c-(e[a||t]||e[t])}switch(u.autoGroup){case"time":u.group=u.autoGroup+"_"+(l<=0?0:Math.floor(Math.log(l)/Math.log(2)));break}if(typeof r=="object"){r=r[u.group||"_"]||Math.round(Math.log((undefined||8192)/(undefined||1/16))/Math.log(2))}function f(){var e=(window.location.search||"").slice(1).split("&");var t={};var n,o;for(o=e.length;o--;){if((n=e[o].split("=")).length!==2)continue;t[n[0]]=n[1]}return t.ctk==="true"}var h=f();var p=null,m=p&&p[Math.floor((c+288e5)/(864e5/144))%144]||1,g=h?1:Math.round(Math.max(Math.pow(2,r)*m/(undefined||8192),1));if(Math.floor(Math.random()*g)>0){return}function v(e,t){var r="undefined"+n++,i=window[r]=new Image;i.onload=i.onerror=function(){window[r]=null};var a=["type="+encodeURIComponent(u.type||"normal"),"name="+encodeURIComponent(e),"parent="+encodeURIComponent(t||""),"module="+encodeURIComponent(u.dataId||"843"),"msg="+encodeURIComponent(u.msg||""),"version="+encodeURIComponent("4.0.4"),"sample="+g,"time="+(l>0?l:0)].join("&");i.src="//gm.mmstat.com/tmjs.1.1?"+a+"&hash="+o(a)}if(u.group){v(i+"|"+u.group,i)}v(i,a)}}();_CTK3d8e(21,"codetrack.init");var g=function(e){u(t,e);function t(e,n,o){i(this,t);return a(this,Object.getPrototypeOf(t).call(this,e,n,o))}o(t,[{key:"parseItem",value:function e(n,o){n=r(Object.getPrototypeOf(t.prototype),"parseItem",this).apply(this,arguments);n.itemActPrice=n.itemActPrice?n.itemActPrice:n.exActiveSalePrice?n.exActiveSalePrice:"";n.itemMPrice=n.itemMPrice?n.itemMPrice:n.exMobilePrice?n.exMobilePrice:"";n.itemMonthSoldCount=n.itemMonthSoldCount?n.itemMonthSoldCount:n.ali_cnt_month?n.ali_cnt_month:"";return n}}]);return t}(m);var v=function(){function e(t){var n=this;i(this,e);this.el=t.el;this.$el=s(t.el);this.$contentEl=this.$el.find(".content");this.showCart=t.showCart;this.itemUdpId=this.$el.data("item-udpid")+"";this.customUdpId=this.$el.data("custom-udpid")+"";this.query=this.$el.data("query");this.pullHasDestroy=false;var o=[this.itemUdpId];if(this.customUdpId){o.push(this.customUdpId)}var r=new c({data:Object.assign({appId:o.join(","),page:1,pageSize:30},this.query)},{},{backupParams:{type:this.query.type,banner_id:this.query.banner_id}});this.chaoshiItem=new g(this.$contentEl[0],h,{lazyloadSrc:"data-ks-lazyload",showCart:this.showCart});r.on("beforeSend",function(){if(!n.loading){var e=n.$el.find(".loading").empty();n.loading=new p({target:e[0]});n.loading.show()}}).on("complete",function(){if(!n.hasMore||n.hasMore==="0"){n.loading.destroy();delete n.loading}});r.on("success",function(e){var t=e.data;var o=false;var i=t[n.itemUdpId]||t,a=t[n.customUdpId];if(a&&a.data&&a.data.length){o=true}n.hasMore=i.hasMore==="1";if(!i||!i.data||!i.data.length){n.loading.hide();if(!n.hasMore&&r.mtopConfig.data.page===1){n.showError()}if(o){return n.chaoshiItem.plugin(new f).append(a.data)}else{return false}}if(o){i.data=i.data.concat(a.data)}if(n.hasMore){r.mtopConfig.data.appId=n.itemUdpId;r.mtopConfig.data.page++;r.mtopConfig.data.index=t.index;r.mtopConfig.data.usedf=t.usedf;n.pullToRequest.resume()}else{n.pullHasDestroy=true;n.pullToRequest.destroy()}n.chaoshiItem.plugin(new f).append(i.data)}).on("error",function(e){n.loading.hide();if(!n.hasMore&&r.mtopConfig.data.page===1){n.showError()}try{if(e.errCode===900){var t=JSON.stringify(r.mtopConfig.data);_CTK3d8e(0,"error:dataError","chaoshi-brand-rec-list.init",{group:window.location.href,msg:"\u63a5\u53e3\u8fd4\u56de\u6570\u636e\u9519\u8bef: "+t,type:"error"})}else{var o=e.res.ret;var i=s.isArray(o)?o[0]:o;_CTK3d8e(0,"error:fetchMtopError","chaoshi-brand-rec-list.init",{group:window.location.href,msg:"mtop\u8bf7\u6c42\u5931\u8d25,"+i,type:"error"})}}catch(e){}});this.pullToRequest=new l({buffer:window.innerHeight*1.5},function(){r.request();this.pause()});this.pullToRequest.pause();r.request()}o(e,[{key:"showError",value:function e(){this.$contentEl.html('<div class="fetchErrorMsg">\u6570\u636e\u52a0\u8f7d\u5931\u8d25\u4e86\uff0c\u5f85\u4f1a\u518d\u6765\u8bd5\u8bd5\u5457~\uff01</div>');this.pullHasDestroy=true;this.pullToRequest.destroy()}},{key:"resume",value:function e(){if(this.loading){this.loading.show()}if(this.canchedHtml){this.$contentEl.html(this.canchedHtml);this.chaoshiItem.trigger("append")}if(!this.pullHasDestroy){this.pullToRequest.resume()}}},{key:"pause",value:function e(){if(this.$contentEl.html()!==""){this.canchedHtml=this.$contentEl.html();this.$contentEl.html("")}if(!this.pullHasDestroy){this.pullToRequest.pause()}if(this.loading){this.loading.hide()}}}]);return e}();Object.assign(v.prototype,d);n.exports=v});