define("mui/tmall-coupon/index",function(e,n,t){"use strict";var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(n,t,r){if(t)e(n.prototype,t);if(r)e(n,r);return n}}();function o(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}e("mui/kissy-polyfill/index");e("mui/babel-polyfill/index");e("mui/zepto/event");var i=e("mui/zepto/zepto");var a=e("mui/mtop/index");var u=e("mui/tmall-coupon/config");var l=e("mui/tmall-coupon/util");var c=null;var s=false;var f=function(){function n(e){o(this,n);var t=this;t.config=Object.assign(u,e);t._init()}r(n,[{key:"_init",value:function t(){var e=this;i(document).on("click",e.config.selector,function(n){if(s)return false;s=true;var t=i(n.currentTarget).attr("href");var r=l.getCouponInfoFromUrl(t);if(!r.activityId||!r.sellerId){e.alert(e.config.errMsg);return false}e.receiveCoupon(r.activityId,r.sellerId);n.preventDefault();return false})}},{key:"_getErrMsg",value:function f(e){if(!e||!e[0])return self.config.errMsg;return e[0].split("::")[1]||self.config.errMsg}},{key:"alert",value:function p(n){e(["mui/popbox/index","mui/popbox/index.css"],function(e){e.toast({content:n,mask:true,zIndex:9999});s=false})}},{key:"_receiveHandler",value:function v(e){var n=this;switch(e.retType){case a.RESPONSE_TYPE.SESSION_EXPIRED:s=false;document.location.href="//login.tmall.com/?redirectURL="+encodeURIComponent(document.location.href);break;case a.RESPONSE_TYPE.SUCCESS:var t=n.config.sucMsg;if(e.error==="true"){t=n._getErrMsg(e.ret)}n.alert(t);break;default:n.alert(n._getErrMsg(e.ret))}}},{key:"receiveCoupon",value:function m(e,n){var t=this;a.request({api:"mtop.taobao.buyerResourceMtopWriteService.applyCoupon",v:"3.0",data:{uuid:e,supplierId:n},ecode:1,timeout:3e4}).then(function(e){t._receiveHandler(e)},function(e){t._receiveHandler(e)})}}],[{key:"getInstance",value:function d(){if(c===null){return new n}else{return c}}}]);return n}();t.exports=f.getInstance()});