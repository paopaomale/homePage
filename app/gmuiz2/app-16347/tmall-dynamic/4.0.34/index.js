define("mui/tmall-dynamic/index",function(a,e,i){"use strict";var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};var t=function(){function a(a,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(a,n.key,n)}}return function(e,i,n){if(i)a(e.prototype,i);if(n)a(e,n);return e}}();function r(a,e){if(!(a instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=a("mui/zepto/zepto");var s=a("mui/zebra-dynamic/index");var c=a("mui/crossimage/index");var l=a("mui/xtemplate/index");var d=a("mui/datalazyload/index");var f=window.g_config?window.g_config:{};window.$zebra=window.$zebra||{};var u=function(){function e(a){r(this,e);var i=false;if(f.devId==="m"){i=true}this.config=Object.assign({LazyDiff:0,DynamicParentCls:"body",DynamicItemCls:".J_dynamic",DynamicTmsDateCls:".J_dynamic_data",DynamicHtmlCls:".J_tmpl",DynamicCallback:false,closeDomeLazy:false,imgOpFactor:false,DynamicType:"lazyload",isRemoveStyle:true,autoLoadInterval:16,timeout:2e3,duplication:false,loadingClass:"mui-cat-loading",params:{},autoDestroy:true,isOpenMtop:i},a);this.__dynamicTasks=[];this._init()}t(e,[{key:"__pushDynamicTask",value:function i(a){this.__dynamicTasks.push(a);if(!this.__dynamicTaskRunning){this.__dynamicTaskRunning=true;this.__runDynamicTask()}}},{key:"__runDynamicTask",value:function u(){var a=this;var e=this.__dynamicTasks.shift();if(!e){this.__dynamicTaskRunning=false;return}e();var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,a.config.autoLoadInterval)};i(this.__runDynamicTask.bind(this))}},{key:"_init",value:function m(){window.codeTrack=function(){};codeTrack("tmall-dynamic.init");var a=this;if(this.config.DynamicType==="onload"||window.$zebra.closeDomLazy||this.config.closeDomeLazy){if(document.readyState==="complete"){a.__pushDynamicTask(a.loadData.bind(a))}else{o(window).load(function(){return a.__pushDynamicTask(a.loadData.bind(a))})}}else{(function(){var e=d.instance();e.set("diff",0);o.each(a.dynamicEle(),function(i,n){e.addCallback(n,function(){return a.loadData(o(n))})})})()}}},{key:"loadData",value:function y(a){var e=this;var i=this;a=(typeof a==="undefined"?"undefined":n(a))==="object"?a:this.dynamicEle();if(!a||!a.length){var t="\u4e2a\u6027\u6a21\u5757\u7684\u5bb9\u5668\u672a\u627e\u5230,\u65e0\u6cd5\u6e32\u67d3,\u8bf7\u786e\u8ba4\u521d\u59cb\u5316\u6a21\u5757,\u4f20\u5165\u7684DynamicParentCls:"+i.config.DynamicParentCls+"\u8282\u70b9\u662f\u5426\u5b58\u5728,"+(i.errorMsg()||"");console.error(t)}o.each(a,function(a,n){var t=o(n);var r=t.find(i.config.DynamicTmsDateCls);if(!r){codeTrack("error:dynamic.error","tmall-dynamic.init",{msg:"\u4e2a\u6027\u5316\u6a21\u5757\u5bb9\u5668\u4e0d\u5b58\u5728"+i.errorMsg(t)||""});return}var c=o.trim(r.val());var d=i.analysisData(c,i.errorMsg(t));var f=new l(t.find(i.config.DynamicHtmlCls).html());var u=false;if(d.error){e.rendWithNoData(t,f,d);return false}t.addClass(i.config.loadingClass);if(d.version&&d.version==="v1"){var m=d.data;if(d.dataUrl){i.__getDynamicData(t,f,d,u)}else{i.renderCallback(t,f,m,u)}}else{s(d,function(a){i.renderCallback(t,f,a,u)},{timeout:i.config.timeout,duplication:i.config.duplication,params:i.config.params,mtop:i.config.isOpenMtop})}})}},{key:"analysisData",value:function h(a){if(!a){a={version:"v1",data:a};try{console.warn("\u6a21\u5757textarea\u6570\u636e\u5bb9\u5668\u4e2d\u5e76\u672a\u83b7\u53d6\u5230\u5bf9\u5e94\u6570\u636e,\u8bf7\u786e\u5b9a\u4e0b\u662f\u5426\u6709\u586b\u5199\u6570\u636e,"+(this.errorMsg()||""))}catch(e){}}try{var i=o.parseJSON(a);if(i.defaultData||i.dataUrl){a={version:"v1",data:i.defaultData||[],dataUrl:i.dataUrl||""}}}catch(e){}return a}},{key:"dynamicEle",value:function v(){if(this.$eleNode){return this.$eleNode}var a=[];if(this.config.DynamicItemCls&&this.config.DynamicItemCls.length>=1&&n(this.config.DynamicItemCls)=="object"&&this.config.DynamicItemCls instanceof NodeList){o.each(this.config.DynamicItemCls,function(e,i){a.push(i)})}else{a=this.config.DynamicItemCls}this.$eleNode=o(a,this.config.DynamicParentCls);return this.$eleNode}},{key:"__getDynamicData",value:function g(e,i,n,t){var r=this;var o=n.dataUrl;var s=(new Date).getTime();var c=n.data||{};if(o){o+=(o.indexOf("?")>0?"&_pvuuid=":"?_pvuuid=")+s}var l=a("mui/fetch/jsonp");l(o,{method:"jsonp",timeout:r.config.timeout,jsonpCallback:"callback"}).then(function(a){return a.json()}).then(function(a){var n=!a||a.data?c:a.data;r.renderCallback(e,i,n,!a||!a.exposureParam?t:a.exposureParam)})["catch"](function(a){codeTrack("error:dynamic.error","tmall-dynamic.init",{msg:"\u4e2a\u6027\u5316\u8bf7\u6c42\u5931\u8d25"+(r.errorMsg()||"")+",\u9519\u8bef\u539f\u56e0\u4e3a:"+a})})}},{key:"renderCallback",value:function p(a,i,n,t){var r=this;if(o.isArray(n)&&window.$zebra.maxDataNum){var s=n.length,c=window.$zebra.maxDataNum>=s?s:window.$zebra.maxDataNum;n=n.splice(0,c);if(c<s){a.height("auto")}}if(o.isFunction(r.config.DynamicCallback)){r.config.DynamicCallback(a[0],i,n)}else{a.html(i.render(n))}r.resetStyle(a);a.removeClass(r.config.loadingClass);e.createLazy(a,this.config);o(window).trigger("windowActDynamicLoad",a)}},{key:"resetStyle",value:function D(a){if(a){var i=a.parent();if(i&&this.config.isRemoveStyle){var n=e.hasAttr(i),t=e.hasAttr(a);i.removeClass("J_flex_style");n.hasPadding&&i.css("paddingTop",0);n.hasHeight&&i.css("height","auto");t.hasPadding&&a.css("paddingTop",0);t.hasHeight&&a.css("height","auto")}}o("body").trigger("refresh.mui-scrollspy")}},{key:"rendWithNoData",value:function w(a,e,i){if(o.isFunction(this.config.DynamicCallback)){this.config.DynamicCallback(a,e,i);this.resetAttr(a)}}},{key:"errorMsg",value:function b(a){var e=window.location.href.split("?");var i="";var n="";var t=undefined;var r=a?a:this.dynamicEle();if(e&&e[0]){e=e[0]}if(r){var o=r.closest(".mui-zebra-module");if(o){n=o.attr("id");i=o.find("div[data-mod-name]").attr("data-mod-name")}}e+=n?"#"+n:"";t="\u9519\u8bef\u9875\u9762:"+e;if(i){t+=";\u9519\u8bef\u6a21\u5757\u540d\u79f0:"+i}return t}}],[{key:"createLazy",value:function k(a){var e=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var i=e.LazyDiff||0;if(!a){return}i=window.$zebra.lazyDiff?window.$zebra.lazyDiff:i;var n=[75,60,90,30];var t=75;if(window.$zebra.imgOpFactor){t=window.$zebra.imgOpFactor}t=e.imgOpFactor||t;e.sharpen=e.sharpen?e.sharpen:f.devId==="pc"?0:30;var r=window.$zebra.sharpen?window.$zebra.sharpen:e.sharpen;try{var s=window.location.search.split("&");o.each(s,function(a,e){var i=e.indexOf("wh_q=");if(i>=0){return s=e.slice(i+4)}});s=parseInt(s);t=s?s:t}catch(l){}var u=undefined;if(e.imgOpFactor){e.autoDestroy=false;u=d.instance()}else{u=new d}u.set("diff",i);if(f.devId==="m"){u.set("fade",false)}u.set("autoDestroy",e.autoDestroy);if(typeof c!=="undefined"&&o.inArray(t,n)>=0){u.set("onStart",c.DatalazyPlugin(a,{quality:"q"+t,sharpen:"s"+r}))}u.addElements(a[0]||a)}},{key:"hasAttr",value:function _(a){if(!a.attr){a=o(a)}var e=a&&a.attr("style");if(!e||(typeof e==="undefined"?"undefined":n(e))==="object"){return{hasPadding:false,hasHeight:false}}var i=e.toLowerCase();return{hasPadding:i.indexOf("padding-top")>=0||i.indexOf("paddingTop")>=0,hasHeight:i.indexOf("height")>=0}}}]);return e}();i.exports=u});