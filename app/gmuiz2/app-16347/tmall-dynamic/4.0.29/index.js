define("mui/tmall-dynamic/index",function(a,i,e){"use strict";var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol?"symbol":typeof a};var t=function(){function a(a,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(a,n.key,n)}}return function(i,e,n){if(e)a(i.prototype,e);if(n)a(i,n);return i}}();function r(a,i){if(!(a instanceof i)){throw new TypeError("Cannot call a class as a function")}}var o=a("mui/zepto/zepto");var s=a("mui/zebra-dynamic/index");var c=a("mui/crossimage/index");var l=a("mui/xtemplate/index");var f=a("mui/datalazyload/index");var d=window.g_config?window.g_config:{};window.$zebra=window.$zebra||{};var u=function(){function i(a){r(this,i);var e=false;if(d.devId==="m"){e=true}this.config=Object.assign({LazyDiff:0,DynamicParentCls:"body",DynamicItemCls:".J_dynamic",DynamicTmsDateCls:".J_dynamic_data",DynamicHtmlCls:".J_tmpl",DynamicCallback:false,closeDomeLazy:false,imgOpFactor:false,DynamicType:"lazyload",isRemoveStyle:true,autoLoadInterval:16,timeout:2e3,duplication:false,loadingClass:"mui-cat-loading",params:{},autoDestroy:true,isOpenMtop:e},a);this.__dynamicTasks=[];this._init()}t(i,[{key:"__pushDynamicTask",value:function e(a){this.__dynamicTasks.push(a);if(!this.__dynamicTaskRunning){this.__dynamicTaskRunning=true;this.__runDynamicTask()}}},{key:"__runDynamicTask",value:function u(){var a=this;var i=this.__dynamicTasks.shift();if(!i){this.__dynamicTaskRunning=false;return}i();var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(i){setTimeout(i,a.config.autoLoadInterval)};e(this.__runDynamicTask.bind(this))}},{key:"_init",value:function m(){window.codeTrack=function(){};codeTrack("tmall-dynamic.init");var a=this;if(this.config.DynamicType==="onload"||window.$zebra.closeDomLazy||this.config.closeDomeLazy){if(document.readyState==="complete"){a.__pushDynamicTask(a.loadData.bind(a))}else{o(window).load(function(){return a.__pushDynamicTask(a.loadData.bind(a))})}}else{(function(){var i=f.instance();i.set("diff",0);o.each(a.dynamicEle(),function(e,n){i.addCallback(n,function(){return a.loadData(o(n))})})})()}}},{key:"loadData",value:function y(a){var i=this;var e=this;a=(typeof a==="undefined"?"undefined":n(a))==="object"?a:this.dynamicEle();if(!a||!a.length){var t="\u4e2a\u6027\u6a21\u5757\u7684\u5bb9\u5668\u672a\u627e\u5230,\u65e0\u6cd5\u6e32\u67d3,\u8bf7\u786e\u8ba4\u521d\u59cb\u5316\u6a21\u5757,\u4f20\u5165\u7684DynamicParentCls:"+e.config.DynamicParentCls+"\u8282\u70b9\u662f\u5426\u5b58\u5728,"+(e.errorMsg()||"");console.error(t)}o.each(a,function(a,n){var t=o(n);var r=t.find(e.config.DynamicTmsDateCls);if(!r){codeTrack("error:dynamic.error","tmall-dynamic.init",{msg:"\u4e2a\u6027\u5316\u6a21\u5757\u5bb9\u5668\u4e0d\u5b58\u5728"+e.errorMsg(t)||""});return}var c=o.trim(r.val());var f=e.analysisData(c,e.errorMsg(t));var d=new l(t.find(e.config.DynamicHtmlCls).html());var u=false;if(f.error){i.rendWithNoData(t,d,f);return false}t.addClass(e.config.loadingClass);if(f.version&&f.version==="v1"){var m=f.data;if(f.dataUrl){e.__getDynamicData(t,d,f,u)}else{e.renderCallback(t,d,m,u)}}else{s(f,function(a){e.renderCallback(t,d,a,u)},{timeout:e.config.timeout,duplication:e.config.duplication,params:e.config.params,mtop:e.config.isOpenMtop})}})}},{key:"analysisData",value:function h(a){if(!a){a={version:"v1",data:a};console.error("textarea\u6570\u636e\u5bb9\u5668\u4e2d\u5e76\u672a\u83b7\u53d6\u5230\u5bf9\u5e94\u6570\u636e,"+(this.errorMsg()||""))}try{var i=o.parseJSON(a);if(i.defaultData||i.dataUrl){a={version:"v1",data:i.defaultData||[],dataUrl:i.dataUrl||""}}}catch(e){}return a}},{key:"dynamicEle",value:function v(){if(this.$eleNode){return this.$eleNode}var a=[];if(this.config.DynamicItemCls&&this.config.DynamicItemCls.length>=1&&n(this.config.DynamicItemCls)=="object"&&this.config.DynamicItemCls instanceof NodeList){o.each(this.config.DynamicItemCls,function(i,e){a.push(e)})}else{a=this.config.DynamicItemCls}this.$eleNode=o(a,this.config.DynamicParentCls);return this.$eleNode}},{key:"__getDynamicData",value:function g(i,e,n,t){var r=this;var o=n.dataUrl;var s=(new Date).getTime();var c=n.data||{};if(o){o+=(o.indexOf("?")>0?"&_pvuuid=":"?_pvuuid=")+s}var l=a("mui/fetch/jsonp");l(o,{method:"jsonp",timeout:r.config.timeout,jsonpCallback:"callback"}).then(function(a){return a.json()}).then(function(a){var n=!a||a.data?c:a.data;r.renderCallback(i,e,n,!a||!a.exposureParam?t:a.exposureParam)})["catch"](function(a){codeTrack("error:dynamic.error","tmall-dynamic.init",{msg:"\u4e2a\u6027\u5316\u8bf7\u6c42\u5931\u8d25"+(r.errorMsg()||"")+",\u9519\u8bef\u539f\u56e0\u4e3a:"+a})})}},{key:"renderCallback",value:function p(a,e,n,t){var r=this;if(o.isArray(n)&&window.$zebra.maxDataNum){var s=n.length,c=window.$zebra.maxDataNum>=s?s:window.$zebra.maxDataNum;n=n.splice(0,c);if(c<s){a.height("auto")}}if(o.isFunction(r.config.DynamicCallback)){r.config.DynamicCallback(a[0],e,n)}else{a.html(e.render(n))}r.resetStyle(a);a.removeClass(r.config.loadingClass);i.createLazy(a,this.config);o(window).trigger("windowActDynamicLoad",a)}},{key:"resetStyle",value:function D(a){if(a){var e=a.parent();if(e&&this.config.isRemoveStyle){var n=i.hasAttr(e),t=i.hasAttr(a);e.removeClass("J_flex_style");n.hasPadding&&e.css("paddingTop",0);n.hasHeight&&e.css("height","auto");t.hasPadding&&a.css("paddingTop",0);t.hasHeight&&a.css("height","auto")}}o("body").trigger("refresh.mui-scrollspy")}},{key:"rendWithNoData",value:function w(a,i,e){if(o.isFunction(this.config.DynamicCallback)){this.config.DynamicCallback(a,i,e);this.resetAttr(a)}}},{key:"errorMsg",value:function b(a){var i=window.location.href.split("?");var e="";var n="";var t=void 0;var r=a?a:this.dynamicEle();if(i&&i[0]){i=i[0]}if(r){var o=r.closest(".mui-zebra-module");if(o){n=o.attr("id");e=o.find("div[data-mod-name]").attr("data-mod-name")}}i+=n?"#"+n:"";t="\u9519\u8bef\u9875\u9762:"+i;if(e){t+=";\u9519\u8bef\u6a21\u5757\u540d\u79f0:"+e}return t}}],[{key:"createLazy",value:function k(a){var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var e=i.LazyDiff||0;if(!a){return}e=window.$zebra.lazyDiff?window.$zebra.lazyDiff:e;var n=[75,60,90,30];var t=75;if(window.$zebra.imgOpFactor){t=window.$zebra.imgOpFactor}t=i.imgOpFactor||t;try{var r=window.location.search.split("&");o.each(r,function(a,i){var e=i.indexOf("wh_q=");if(e>=0){return r=i.slice(e+4)}});r=parseInt(r);t=r?r:t}catch(s){}var l=void 0;if(i.imgOpFactor){i.autoDestroy=false;l=f.instance()}else{l=new f}l.set("diff",e);if(d.devId==="m"){l.set("fade",false)}l.set("autoDestroy",i.autoDestroy);if(typeof c!=="undefined"&&o.inArray(t,n)>=0){l.set("onStart",c.DatalazyPlugin(a,{quality:"q"+t}))}l.addElements(a[0]||a)}},{key:"hasAttr",value:function _(a){if(!a.attr){a=o(a)}var i=a&&a.attr("style");if(!i||(typeof i==="undefined"?"undefined":n(i))==="object"){return{hasPadding:false,hasHeight:false}}var e=i.toLowerCase();return{hasPadding:e.indexOf("padding-top")>=0||e.indexOf("paddingTop")>=0,hasHeight:e.indexOf("height")>=0}}}]);return i}();e.exports=u});