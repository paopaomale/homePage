define("mui/chaoshi-sync/price-inventory",function(e,t,n){"use strict";var i=e("./util");var r=e("mui/mtop/index");var o=e("mui/chaoshi-app/site-info");var c=e("mui/zepto/zepto");var a=function s(e,t,n,i,o){function c(e,o){r.request({api:"mtop.tmall.supermarket.itempromotion.get",v:"1.0",ecode:0,data:{itemIds:e.join(","),smAreaId:t,device:n,option:i}}).then(function(e){o(e.data.result)},function(e){console.warn("sync inventory error",e)})}var a=20,u=0,s={};function f(){c(e.slice(u*a,(u+1)*a),function(t){if(t){t.forEach(function(e){s[e.itemId]=e})}if((u+1)*a>=e.length){o(s)}else{u++;f()}})}f()};var u=function f(e){return new Promise(function(t,n){e=i.config(e);var r=[];var u=typeof e.el==="string"?document.querySelector(e.el):e.el;var s=u.querySelectorAll(e.itemEl);var f=[];for(var l=0,v=s.length;l<v;l++){var d=s[l];if(d._itemSyncFixed){continue}var m=d.getAttribute(e.attrId);if(m){r.push(m);f.push(d);d._itemSyncFixed=true}}if(!r.length){return t()}var y=e.useWmPrice?"wap":"pc";var h=null;if(e.syncPrice){h="price"}if(e.syncInventory){h=h?"":"inventory"}var p=function I(){a(r,e.cityId,y,h,function(n){f.forEach(function(t){var i=t.getAttribute(e.attrId);if(!i){return}var r=n[i];if(!r){t._itemSyncFixed=false;return}if(e.syncInventory){if(r.sellout==="true"){c(t).addClass(e.soldOutClass);if(e.inventCallback&&c.isFunction(e.inventCallback)){e.inventCallback(r,t)}}}if(e.syncPrice){var o=r.promotionPrice;var a=t.querySelector(e.priceEl);if(o&&a){if(e.formatPrice&&c.isFunction(e.formatPrice)){o=e.formatPrice(o,a)}a.innerHTML=o}}});t()})};if(e.cityId){p()}else{o.request().then(function(t){e.cityId=t.districtId||t.cityId;p()})}})};n.exports=u});