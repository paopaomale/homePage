define("mui/zebra-universal-single/index",["mui/zepto/zepto","mui/datalazyload/index","mui/crossimage/index","mui/xtemplate/index","mui/zebra-lib-xy/uri"],function(e,n,t){var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(n,t,i){if(t)e(n.prototype,t);if(i)e(n,i);return n}}();function a(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}var o=e("mui/zepto/zepto");var r=e("mui/datalazyload/index");var u=e("mui/crossimage/index");var f=e("mui/xtemplate/index");var l=e("mui/zebra-lib-xy/uri");var m=function(){function n(e,t){var i=this;a(this,n);if(!t||!t.canvasConfig){return}var m=r.instance();m.addStartListener(u.DatalazyPlugin(e,{quality:"Q90"}));var c=o(e).hasClass("preview");if(t.moduleConfig){t.moduleConfig=JSON.parse(t.moduleConfig)}if(t.canvasConfig){t.canvasConfig=JSON.parse(t.canvasConfig)}if(t.elements){t.elements=JSON.parse(t.elements)}if(t.mapConfig){t.mapConfig=JSON.parse(t.mapConfig)}var s=new f(o(".item-xtpl",e).html());if(t&&t.moduleConfig&&t.moduleConfig.dataAPI){(function(){var n={};if(t.moduleConfig.params&&t.moduleConfig.params.length>0){(function(){var e=new l(location.href);t.moduleConfig.params.forEach(function(t){if(t.fromUrl&&!c){n[t.key]=e.getItem(t.key)||""}else{n[t.key]=t.value}})})()}if(t.moduleConfig.isMtop){i._getMtopData(t.moduleConfig.dataAPI,n).then(function(n){o(".content",e).html(s.render(i._getDomStr(n,t.elements,t.mapConfig)));m.addElements(e)},function(n){o(e).hide()})}else{i._getData(t.moduleConfig.dataAPI,n).then(function(n){o(".content",e).html(s.render(i._getDomStr(n,t.elements,t.mapConfig)));m.addElements(e)},function(n){o(e).hide()})}})()}else{o(".content",e).html(s.render({}));m.addElements(e)}}i(n,[{key:"_getDomStr",value:function e(n,t,i){var a=this;var o={};t.forEach(function(e,t){if(e&&e.schema){i.forEach(function(i){if(!i.elementPath[1]){return}var r=parseInt(i.elementPath[1].substr(0,i.elementPath[1].indexOf("-")));if(r===t){o["item"+t+i.elementPath[2]]=i.dataPath.reduce(function(e,n,t){return e?e[n]:null},{result:n});if(e.type==="price"&&i.elementPath[2]==="promotion"&&e.decimal){var u=a._splitPrice(o["item"+t+"promotion"]);o["item"+t+"integer"]=u.integer;o["item"+t+"decimal"]=u.decimal}}})}});return o}},{key:"_splitPrice",value:function e(n){var t=/([\d|?]+)(\.\d*)?/;var i=t.exec(n.toString());return{integer:i[1]||"?",decimal:i[2]||""}}},{key:"_getMtopData",value:function n(t,i){return new Promise(function(n,a){e(["mui/mtop/index"],function(e){var o=location.href;if(o.indexOf("env=pre")>-1){lib.mtop.config.subDomain="wapa"}else if(o.indexOf("env=daily")>-1){lib.mtop.config.subDomain="waptest"}e.request({api:t,v:"1.0",ecode:0,data:i}).then(function(e){if(e){n(e)}else{a()}},function(e){a(e)})})})}},{key:"_getData",value:function n(t,i){return new Promise(function(n,a){e(["mui/fetch/jsonp"],function(e){e(t,{method:"jsonp",timeout:4e3,body:i}).then(function(e){return e.json()}).then(function(e){if(e){n(e)}else{a()}}).catch(function(e){a(e)})})})}}]);return n}();t.exports={initView:function e(n,t,i,a){var o=JSON.parse(t.zebraCfg||"{}");new m(n,o)}}});