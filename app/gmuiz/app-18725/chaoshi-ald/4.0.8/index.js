define("mui/chaoshi-ald/index",function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=e("mui/mtop/index");var o=e("mui/custom-event/index");var c=e("mui/chaoshi-app/site-info");var u="mtop.taobao.aladdin.service.AldRecommendService.chaoshi.recommend";var f=u+"2";var s=function(){function t(e,r){i(this,t);this.mtopConfig=Object.assign({v:"1.0",ecode:0},e);this.config=Object.assign({parse:function n(e){return e.data.resultValue},validate:function a(e){return e.retType===0}},r)}n(t,[{key:"request",value:function r(){var e=this;e.trigger("beforeSend",{});return new Promise(function(t,r){c.request().then(function(n){var i=e.mtopConfig.data.appId.indexOf(",")===-1?u:f;var o=Object.assign({api:i},e.mtopConfig);o.data=Object.assign({smAreaId:n.cityId,logica:n.logica},o.data);e.mtopConfig=Object.assign({},o);a.request(o).then(function(n){if(e.config.validate(n)){var i=e.config.parse(n);var a={data:i,res:n,from:0};t(a);e.trigger("success",a);e.trigger("complete",a)}else{if(e.genFallbackConfig){e.requestFallback(n).then(t,r)}else{var o={errCode:900,res:n,from:0};r(o);e.trigger("error",o);e.trigger("complete",o)}}},function(n){if(e.genFallbackConfig){e.requestFallback(n).then(t,r)}else{var i={errCode:901,res:n,from:0};r(i);e.trigger("error",i);e.trigger("complete",i)}})})})}},{key:"requestFallback",value:function o(t){var r=this;return new Promise(function(n,i){r.genFallbackConfig(function(a){e(["mui/fetch/jsonp"],function(e){e(a.url,Object.assign({method:"jsonp"},a.params)).then(function(e){return e.json()}).then(function(e){var t={data:{resultValue:e},retType:0};if(r.config.validate(t)){var a=r.config.parse(t);var o={data:a,res:e,from:1};n(o);r.trigger("success",o);r.trigger("complete",o)}else{var c={errCode:900,res:e,from:1};i(c);r.trigger("error",c);r.trigger("complete",c)}})["catch"](function(e){var n={errCode:901,ex:e,res:t,from:1};i(n);r.trigger("error",n);r.trigger("complete",n)})})})})}}]);return t}();Object.assign(s.prototype,o);r.exports=s});