define("mui/zebra-dynamic/index",["mui/zepto/touch","mui/zebra-dynamic/request"],function(t,e,a){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),o=t("mui/zepto/touch"),i=t("mui/zebra-dynamic/request"),c=function(t){return"[object Object]"===Object.prototype.toString.call(t)};window.codeTrack=function(){};var u=function(){function t(e){if(r(this,t),codeTrack("dynamic.init"),this.cfg=e,this.config=e.config||{},!this.cfg.data)throw codeTrack("error:init.error","dynamic.init",{msg:"conf\u53c2\u6570\u5fc5\u987b\u4e3ajson\u6216json\u5b57\u7b26\u4e32: "+this.cfg.data}),new Error("conf\u53c2\u6570\u5fc5\u987b\u4e3ajson\u6216json\u5b57\u7b26\u4e32");if(!this.request){var a=parseInt(this.config.timeout,10);a=a?a>100?a:1e3*a:8e3,this.request=new i({timeout:a,closeBackup:this.config.closeBackup||!1,duplication:!!this.config.duplication,mtop:!!this.config.mtop,mtopApiName:this.config.mtopApiName||void 0,params:c(this.config.params)?this.config.params:{},backupParams:c(this.config.backupParams)?this.config.backupParams:{},forceBackupHasParam:this.config.forceBackupHasParam||!1})}this.xPathList={},this._stringfiyToResult(this.cfg)}return n(t,[{key:"_stringfiyToResult",value:function(t){codeTrack("dynamic.parse","dynamic.init");var e="string"==typeof t.data?JSON.parse(t.data):t.data,a=t.key,r=t.callback,n=a?e[a]:e;if(!n){var o=a+" is undefiend";throw codeTrack("error:tag.error","dynamic.parse",{msg:o}),new Error(o)}this._getData(n).then(r)["catch"](function(t){throw t})}},{key:"_getData",value:function(t){var e=this;return this._parse(t),o.isEmptyObject(e.request.requestStack)?Promise.resolve(t):e.request.run().then(function(a){return o.each(a,function(a,r){o.each(e.xPathList,function(e,n){a===n&&!function(){var a=e.split("."),n=a.pop(),o=t;a.forEach(function(t,e){t&&(o=o[t])}),n?o[n]=r:t=r}()})}),e.xPathList={},t})}},{key:"_parse",value:function(t,e){var a=this;if(e=e||"",this._isTag(t)){var r=this._checkTagIsDynamic(t);return r?void this._push(t,r,e):void o.each(t,function(t,r){a._isTag(r)&&a._parse(r,e+"."+t)})}}},{key:"_isTag",value:function(t){return Array.isArray(t)||c(t)}},{key:"_push",value:function(t,e,a){var r=Array.isArray(t),n=r?t[0]:t;this.xPathList[a]=e,this.request.push(n)}},{key:"_checkTagIsDynamic",value:function(t){var e=Array.isArray(t);return!!e&&(!(t.length>1)&&this._checkDataConfig(t[0]))}},{key:"_checkDataConfig",value:function(t){if(!t||!c(t))return!1;var e=t.__data_type&&t.__data_source&&t.__data_url&&t.__data_param&&c(t.__data_param)&&t.__data_default;return!!e&&t.__data_param.appId}}]),t}();a.exports=function(t,e,a,r){return o.isFunction(e)&&(r=a,a=e,e=null),new u({data:t,key:e,callback:a,config:r})}});