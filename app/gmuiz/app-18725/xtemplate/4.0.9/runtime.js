define("mui/xtemplate/runtime",["./runtime/util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(e,r,n){"use strict";var t=e("./runtime/util");var i=e("./runtime/commands");var a={};var f=e("./runtime/scope");var o=e("./runtime/linked-buffer");function u(e,r,n,t,i,a,f,o){this.name=e;this.originalName=a||e;this.runtime=r;this.root=n;this.pos={line:1};this.scope=t;this.buffer=i;this.fn=f;this.parent=o}function s(e,r,n){var t=n[0];var i=e&&e[t]||r&&r[t]||a[t];if(n.length===1){return i}if(i){var f=n.length;for(var o=1;o<f;o++){i=i[n[o]];if(!i){return false}}}return i}function l(e,r){var n=e.split("/");var t=r.split("/");n.pop();for(var i=0,a=t.length;i<a;i++){var f=t[i];if(f==="."){continue}else if(f===".."){n.pop()}else{n.push(f)}}return n.join("/")}function v(e,r,n,t,i,a){var f=void 0;var o=void 0;var u=void 0;if(!a){u=s(e.runtime.commands,e.root.config.commands,i)}if(u){return u.call(e,r,n,t)}else if(u!==false){var l=i.slice(0,-1);f=r.resolve(l,a);if(f===null||f===undefined){t.error("Execute function `"+i.join(".")+"` Error: "+l.join(".")+" is undefined or null");return t}o=f[i[i.length-1]];if(o){try{return o.apply(f,n.params||[])}catch(v){t.error("Execute function `"+i.join(".")+"` Error: "+v.message);return t}}}t.error("Command Not Found: "+i.join("."));return t}var c={callFn:v,callDataFn:function k(e,r){var n=r[0];var t=n;for(var i=1;i<r.length;i++){var a=r[i];if(t&&t[a]){n=t;t=t[a]}else{return""}}return t.apply(n,e||[])},callCommand:function w(e,r,n,t,i){return v(e,r,n,t,i)}};function d(e,r){this.fn=e;this.config=t.merge(d.globalConfig,r);this.subNameResolveCache={};this.loadedSubTplNames={}}t.mix(d,{config:function T(e,r){var n=this.globalConfig=this.globalConfig||{};if(e!==undefined){if(r!==undefined){n[e]=r}else{t.mix(n,e)}}else{return n}},nativeCommands:i,utils:c,util:t,addCommand:function C(e,r){a[e]=r},removeCommand:function E(e){delete a[e]}});function h(e,r,n){var t=r;if(t.charAt(0)!=="."){return t}var i=n+"_ks_"+t;var a=e.subNameResolveCache;var f=a[i];if(f){return f}t=a[i]=l(n,t);return t}function m(e,r,n,t,i,a,f,o){var s=new u(r,n,e,t,i,a,undefined,o);i.tpl=s;e.config.loader.load(s,function(e,r){var n=r;if(typeof n==="function"){s.fn=n;g(s)}else if(e){i.error(e)}else{n=n||"";if(f){i.writeEscaped(n)}else{i.data+=n}i.end()}})}function p(e,r,n,t,i,a){var f=h(e,a,i.name);var o=t.insert();var u=o.next;m(e,f,i.runtime,r,o,a,n,t.tpl);return u}function x(e,r,n,t,i){var a=n.insert();var f=a.next;var o=new u(i.TPL_NAME,t.runtime,e,r,a,undefined,i,n.tpl);a.tpl=o;g(o);return f}function g(e){var r=e.fn();if(r){var n=e.runtime;var t=n.extendTpl;var i=void 0;if(t){i=t.params[0];if(!i){return r.error("extend command required a non-empty parameter")}}var a=n.extendTplFn;var f=n.extendTplBuffer;if(a){n.extendTpl=null;n.extendTplBuffer=null;n.extendTplFn=null;x(e.root,e.scope,f,e,a).end()}else if(i){n.extendTpl=null;n.extendTplBuffer=null;p(e.root,e.scope,0,f,e,i).end()}return r.end()}}function b(e,r,n){var i=r.params;if(!i[0]){return n.error("include command required a non-empty parameter")}var a=e;var o=i[1];var u=r.hash;if(u){if(o){o=t.mix({},o)}else{o={}}t.mix(o,u)}if(o){a=new f(o,undefined,e)}return a}function y(e,r,n){var t=r.params[0];var i=h(e,t,n.name);var a=e.loadedSubTplNames;if(a[i]){return false}a[i]=true;return true}d.prototype={constructor:d,Scope:f,nativeCommands:i,utils:c,removeCommand:function O(e){var r=this.config;if(r.commands){delete r.commands[e]}},addCommand:function A(e,r){var n=this.config;n.commands=n.commands||{};n.commands[e]=r},include:function N(e,r,n,t){return p(this,b(e,r,n),r.escape,n,t,r.params[0])},includeModule:function j(e,r,n,t){return x(this,b(e,r,n),n,t,r.params[0])},includeOnce:function I(e,r,n,t){if(y(this,r,t)){return this.include(e,r,n,t)}return n},includeOnceModule:function L(e,r,n,t){if(y(this,r,t)){return this.includeModule(e,r,n,t)}return n},render:function B(e,r,n){var t=this;var i=r;var a=n;var o="";var s=this.fn;var l=this.config;if(typeof i==="function"){a=i;i=null}i=i||{};if(!a){a=function p(e,r){var n=e;if(n){if(!(n instanceof Error)){n=new Error(n)}throw n}o=r}}var v=this.config.name;if(!v&&s&&s.TPL_NAME){v=s.TPL_NAME}var c=void 0;if(e instanceof f){c=e}else{c=new f(e)}var h=new d.LinkedBuffer(a,l).head;var m=new u(v,{commands:i.commands},this,c,h,v,s);h.tpl=m;if(!s){l.loader.load(m,function(e,r){if(r){m.fn=t.fn=r;g(m)}else if(e){h.error(e)}});return o}g(m);return o}};d.Scope=f;d.LinkedBuffer=o;n.exports=d});define("mui/xtemplate/runtime/util",["./escape-html"],function(e,r,n){"use strict";var t=e("./escape-html");var i=/\\?\{([^{}]+)\}/g;var a=typeof global!=="undefined"?global:window;var f=void 0;var o=Object.prototype.toString;n.exports=f={isArray:Array.isArray||function(e){return o.call(e)==="[object Array]"},keys:Object.keys||function(e){var r=[];var n=void 0;for(n in e){r.push(n)}return r},each:function u(e,r){var n=arguments.length<=2||arguments[2]===undefined?null:arguments[2];if(e){var t=void 0;var i=void 0;var a=void 0;var o=0;var u=e&&e.length;var s=u===undefined||Object.prototype.toString.call(e)==="[object Function]";if(s){a=f.keys(e);for(;o<a.length;o++){t=a[o];if(r.call(n,e[t],t,e)===false){break}}}else{for(i=e[0];o<u;i=e[++o]){if(r.call(n,i,o,e)===false){break}}}}return e},mix:function s(e,r){if(r){for(var n in r){e[n]=r[n]}}return e},globalEval:function l(e){if(a.execScript){a.execScript(e)}else{(function(e){a.eval.call(a,e)})(e)}},substitute:function v(e,r,n){if(typeof e!=="string"||!r){return e}return e.replace(n||i,function(e,n){if(e.charAt(0)==="\\"){return e.slice(1)}return r[n]===undefined?"":r[n]})},escapeHtml:t,merge:function c(){var e=0;var r=arguments.length;var n={};for(;e<r;e++){var t=arguments.length<=e+0?undefined:arguments[e+0];if(t){f.mix(n,t)}}return n}}});define("mui/xtemplate/runtime/escape-html",function(e,r,n){"use strict";var t=/["'&<>]/;n.exports=i;function i(e){var r=""+e;var n=t.exec(r);if(!n){return r}var i;var a="";var f=0;var o=0;for(f=n.index;f<r.length;f++){switch(r.charCodeAt(f)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 39:i="&#39;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}if(o!==f){a+=r.substring(o,f)}o=f+1;a+=i}return o!==f?a+r.substring(o,f):a}});define("mui/xtemplate/runtime/commands",["./scope","./util"],function(e,r,n){"use strict";var t=e("./scope");var i=e("./util");var a={range:function f(e,r){var n=r.params;var t=n[0];var i=n[1];var a=n[2];if(!a){a=t>i?-1:1}else if(t>i&&a>0||t<i&&a<0){a=-a}var f=[];for(var o=t;t<i?o<i:o>i;o+=a){f.push(o)}return f},foreach:function o(e,r,n){var i=n;var a=r.params;var f=a[0];var o=a[2]||"xindex";var u=a[1];var s=void 0;var l=void 0;var v=void 0;var c=void 0;if(f){s=f.length;for(c=0;c<s;c++){l=new t(f[c],{xcount:s,xindex:c},e);v=l.affix;if(o!=="xindex"){v[o]=c;v.xindex=undefined}if(u){v[u]=f[c]}i=r.fn(l,i)}}return i},forin:function u(e,r,n){var i=n;var a=r.params;var f=a[0];var o=a[2]||"xindex";var u=a[1];var s=void 0;var l=void 0;var v=void 0;if(f){for(v in f){s=new t(f[v],{xindex:v},e);l=s.affix;if(o!=="xindex"){l[o]=v;l.xindex=undefined}if(u){l[u]=f[v]}i=r.fn(s,i)}}return i},each:function s(e,r,n){var t=r.params;var f=t[0];if(f){if(i.isArray(f)){return a.foreach(e,r,n)}return a.forin(e,r,n)}return n},"with":function l(e,r,n){var i=n;var a=r.params;var f=a[0];if(f){var o=new t(f,undefined,e);i=r.fn(o,i)}return i},"if":function v(e,r,n){var t=n;var i=r.params;var a=i[0];if(a){var f=r.fn;if(f){t=f(e,t)}}else{var o=false;var u=r.elseIfs;var s=r.inverse;if(u){for(var l=0,v=u.length;l<v;l++){var c=u[l];o=c.test(e);if(o){t=c.fn(e,t);break}}}if(!o&&s){t=s(e,t)}}return t},set:function c(e,r,n){var t=e;var i=r.hash;var a=i.length;for(var f=0;f<a;f++){var o=i[f];var u=o.key;var s=o.depth;var l=o.value;if(u.length===1){var v=t.root;while(s&&v!==t){t=t.parent;--s}t.set(u[0],l)}else{var c=t.resolve(u.slice(0,-1),s);if(c){c[u[u.length-1]]=l}}}return n},include:1,includeOnce:1,parse:1,extend:1,block:function d(e,r,n){var t=n;var i=this;var a=i.runtime;var f=r.params;var o=f[0];var u=void 0;if(f.length===2){u=f[0];o=f[1]}var s=a.blocks=a.blocks||{};var l=s[o];var v=void 0;var c={fn:r.fn,type:u};if(!l){s[o]=c}else if(l.type){if(l.type==="append"){c.next=l;s[o]=c}else if(l.type==="prepend"){var d=void 0;v=l;while(v&&v.type==="prepend"){d=v;v=v.next}c.next=v;d.next=c}}if(!a.extendTpl){v=s[o];while(v){if(v.fn){t=v.fn.call(i,e,t)}v=v.next}}return t},macro:function h(e,r,n){var i=n;var a=r.hash;var f=r.params;var o=f[0];var u=f.slice(1);var s=this;var l=s.runtime;var v=l.macros=l.macros||{};var h=v[o];if(r.fn){v[o]={paramNames:u,hash:a,fn:r.fn}}else if(h){var c=h.hash||{};var d=void 0;if(d=h.paramNames){for(var m=0,p=d.length;m<p;m++){var x=d[m];c[x]=u[m]}}if(a){for(var g in a){c[g]=a[g]}}var b=new t(c);b.root=e.root;i=h.fn.call(s,b,i)}else{var y="can not find macro: "+o;i.error(y)}return i}};n.exports=a});define("mui/xtemplate/runtime/scope",function(e,r,n){"use strict";function t(e,r,n){if(e!==undefined){this.data=e}else{this.data={}}if(n){this.parent=n;this.root=n.root}else{this.parent=undefined;this.root=this}this.affix=r||{};this.ready=false}t.prototype={isScope:1,constructor:t,setParent:function i(e){this.parent=e;this.root=e.root},set:function a(e,r){this.affix[e]=r},setData:function f(e){this.data=e},getData:function o(){return this.data},mix:function u(e){var r=this.affix;for(var n in e){r[n]=e[n]}},get:function s(e){var r=this.data;var n=void 0;var t=this.affix;if(r!==null&&r!==undefined){n=r[e]}if(n!==undefined){return n}return t[e]},resolveInternalOuter:function l(e){var r=e[0];var n=void 0;var t=this;var i=t;if(r==="this"){n=t.data}else if(r==="root"){i=i.root;n=i.data}else if(r){do{n=i.get(r)}while(n===undefined&&(i=i.parent))}else{return[i.data]}return[undefined,n]},resolveInternal:function v(e){var r=this.resolveInternalOuter(e);if(r.length===1){return r[0]}var n=void 0;var t=e.length;var i=r[1];if(i===undefined){return undefined}for(n=1;n<t;n++){if(i===null||i===undefined){return i}i=i[e[n]]}return i},resolveLooseInternal:function c(e){var r=this.resolveInternalOuter(e);if(r.length===1){return r[0]}var n=void 0;var t=e.length;var i=r[1];for(n=1;i!==null&&i!==undefined&&n<t;n++){i=i[e[n]]}return i},resolveUp:function d(e){return this.parent&&this.parent.resolveInternal(e)},resolveLooseUp:function h(e){return this.parent&&this.parent.resolveLooseInternal(e)},resolveOuter:function m(e,r){var n=this;var t=n;var i=r;var a=void 0;if(!i&&e.length===1){a=n.get(e[0]);if(a!==undefined){return[a]}i=1}if(i){while(t&&i--){t=t.parent}}if(!t){return[undefined]}return[undefined,t]},resolveLoose:function p(e,r){var n=this.resolveOuter(e,r);if(n.length===1){return n[0]}return n[1].resolveLooseInternal(e)},resolve:function x(e,r){var n=this.resolveOuter(e,r);if(n.length===1){return n[0]}return n[1].resolveInternal(e)}};n.exports=t});define("mui/xtemplate/runtime/linked-buffer",["./util"],function(e,r,n){"use strict";var t=e("./util");function i(e,r,n){this.list=e;this.init();this.next=r;this.ready=false;this.tpl=n}i.prototype={constructor:i,isBuffer:1,init:function f(){this.data=""},append:function o(e){this.data+=e;return this},write:function u(e){if(e!==null&&e!==undefined){if(e.isBuffer){return e}this.data+=e}return this},writeEscaped:function s(e){if(e!==null&&e!==undefined){if(e.isBuffer){return e}this.data+=t.escapeHtml(e)}return this},insert:function l(){var e=this;var r=e.list;var n=e.tpl;var t=new i(r,e.next,n);var a=new i(r,t,n);e.next=a;e.ready=true;return a},async:function v(e){var r=this.insert();var n=r.next;e(r);return n},error:function c(e){var r=this.list.callback;var n=e;if(r){var t=this.tpl;if(t){if(!(n instanceof Error)){n=new Error(n)}var i=t.name;var a=t.pos.line;var f="XTemplate error in file: "+i+" at line "+a+": ";try{n.stack=f+n.stack;n.message=f+n.message}catch(o){}n.xtpl={pos:{line:a},name:i}}this.list.callback=null;r(n,undefined)}},end:function d(){var e=this;if(e.list.callback){e.ready=true;e.list.flush()}return e}};function a(e,r){var n=this;n.config=r;n.head=new i(n,undefined);n.callback=e;this.init()}a.prototype={constructor:a,init:function h(){this.data=""},append:function m(e){this.data+=e},end:function p(){this.callback(null,this.data);this.callback=null},flush:function x(){var e=this;var r=e.head;while(r){if(r.ready){this.data+=r.data}else{e.head=r;return}r=r.next}e.end()}};a.Buffer=i;n.exports=a});