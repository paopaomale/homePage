(function(t){var e=t.chrome&&chrome.loadTimes;var n=t.performance;var r={config:function(t){if(!n){return}this.config=t;this.sampling=t.sampling||1e3;this.evn={id:t.id,ver:t.ver||"",nk:t.nk||"",net:"",protocol:t.protocol||(e?chrome.loadTimes().connectionInfo:""),ua:t.ua||navigator.userAgent,url:t.url||location.href,navType:function(){if(t.navType){return t.navType}if(n){return performance.navigation.type}if(e){return{LinkClicked:0,FormSubmitted:0,BackForward:2,Reload:1,FormResubmitted:0,Other:255}[chrome.loadTimes().navigationType]}return 0}()};this.formatAction=t.formatAction||this._formatAction},getStartTime:function(){if(n){return performance.timing.navigationStart}},updateNet:function(e){var n=this;if(this.config.net){this.evn.net=this.config.net;return e.apply(this)}if(t.Ali){Ali.ready(function(t){t.network.getType(function(t){n.evn.net=!t.errorCode&&t.type!=="unknown"?t.type:"";e.apply(n)})});return}var r=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(r){this.evn.net=r.type;return e.apply(this)}e.apply(this)},_formatAction:function(t,e){var n="[c"+t+"][uhttp://velocity.tmall.com]"+JSON.stringify({evn:this.evn,data:e});n=encodeURIComponent(n);var r=["type=9","id=jstracker","v=0.02","nick=","ua=","file=","line=","scrolltop=","screen=","msg="+n].join("&");return"//gm.mmstat.com/jstracker.2?"+r},hasChance:function(t){return Math.random()<1/(t||1e3)},send:function(e,n,r){r=r||this.sampling;if(!this.hasChance(r)){return}var i=arguments;this.onLoad(function(){this.updateNet(function(){var e="_velocity_img_"+Date.now();var n=new Image;t[e]=n;n.onload=n.onerror=function(){t[e]=null};n.src=this.formatAction.apply(this,i)})})},onLoad:function(e){var n=this;if(document.readyState==="complete"){e.apply(this)}else{t.addEventListener("load",function(){e.apply(n)})}},onDOMReady:function(e){var n=this;if(document.readyState==="complete"){e.apply(this)}else{t.addEventListener("DOMContentLoaded",function(){e.apply(n)})}}};r.timing=function(t){if(!n){return}var r=this;this.onLoad(function(){setTimeout(function(){var n={};var i=r.getStartTime();if(e){var o=chrome.loadTimes().firstPaintTime*1e3;if(o){n.firstPaint=o-i}}var a=performance.timing;for(var s in a){if(!a.hasOwnProperty(s)){continue}var c;if(a[s]===0){c=-1}else{c=a[s]-i;if(isNaN(c)||c<0)return}n[s]=c}r.send("timing",n,t)},0)})};r.resourceTiming=function(t,e){if(!n||!performance.getEntries){return}var r=[];var i=Object.prototype.toString.call(t);if(i==="[object Array]"){r=t}else if(i==="[object Object]"){r=[t]}else{if(!n){return}var o=arguments.callee;this.onLoad(function(){r=performance.getEntries();e=t;o.apply(this,[r,e])});return}r=function(){var t=[];for(var e=0,n=r.length;e<n;e++){var i=r[e];t.push({name:i.name,initiatorType:i.initiatorType,startTime:Math.round(i.startTime),duration:Math.round(i.duration)})}return t}();for(var a=0,s=r.length;a<s;a+=10){this.send("resourceTiming",r.slice(a,a+10),e)}return r};r.time=function(t,e){this._timeRecord||(this._timeRecord={});this._timeRecord[t]=e||Date.now()};r.timeEnd=function(t,e,r){if(!n){return}if(!this._timeRecord[t]){return}this.send("time",{name:t,startTime:this._timeRecord[t]-this.getStartTime(),duration:(e||Date.now())-this._timeRecord[t]},r);delete this._timeRecord[t]};r.timeStamp=function(t,e,r){if(!n){return}e=parseInt((e||Date.now())-this.getStartTime());this.send("timeStamp",{name:t,startTime:e},r)};r.memory=function(t){if(n&&performance.memory){this.send("memory",performance.memory,t)}};var i=function(){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame;var n=t.cancelAnimationFrame||t.webkitCancelAnimationFrame;return{_requestIDs:{},_fpsArr:{},now:function(){try{return performance.now()}catch(t){return Date.now()}},fps:function(t){if(!e){return}var n=this;var r;var i=function(){var o=n.now();if(!r){r=o;n._requestIDs[t]=e(i);return}n._fpsArr[t].push(1e3/(o-r));r=o;n._requestIDs[t]=e(i)};n._fpsArr[t]=[];n._requestIDs[t]=e(i)},fpsEnd:function(t,e){if(!n){return}n(this._requestIDs[t]);var i=this._fpsArr[t];var o=0;for(var a=0,s=i.length;a<s;a++){o+=i[a]}var c=parseInt(o/i.length);r.send("fps",{name:t,fps:c},e);delete this._fpsArr[t];delete this._requestIDs[t]}}}();r.fps=function(){i.fps.apply(i,arguments)};r.fpsEnd=function(){i.fpsEnd.apply(i,arguments)};t.Velocity=r;if(window.KISSY){KISSY.add("mui/velocity-monitor/index",function(){return r})}})(this);