define("mui/nav-category/index",function(t,e,n){"use strict";var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(t,a.key,a)}}return function(e,n,a){if(n)t(e.prototype,n);if(a)t(e,a);return e}}();function i(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}t("mui/nav-category/index.css");t("mui/prompt/css/loading.css");var o=t("mui/zepto/touch"),r=t("mui/hybrid/index"),l=t("mui/crossimage/index"),s=t("mui/custom-event/index"),c=t("mui/mtop/index"),u=t("mui/nav-category/xtpl/container.xtpl"),h=t("mui/nav-category/xtpl/list.xtpl"),f=t("mui/nav-category/xtpl/menu.xtpl"),d=t("mui/nav-category/xtpl/nav.xtpl"),v=window,m="ontouchstart"in v&&!(v.PointerEvent||v.MSPointerEvent)?"tap":"click",p="onTransitionEnd"in window?"transitionEnd":"webkitTransitionEnd";var $=function(){function t(e){i(this,t);var n=this;n.status="close";n.options=o.extend(true,{channel:"main",isShowLink:false,title:"\u5168\u90e8\u5206\u7c7b",navCallback:function a(t){return t},contentCallback:function r(t){return t},hash:"#mui-nav-category",spm:v.goldlog&&v.goldlog.spm_ab?v.goldlog.spm_ab.join("."):null,nativeConfig:{open:false,tmall:"5.11.0",taobao:"5.4.1",channel:null}},e);o(v).on("#J_Category",function(){n.open()})}a(t,[{key:"_dealData",value:function e(t,n){var a=this,i=t.data.sideBlock.list;if(n){n=n}else if(i.length>0){n=i[0].id}t.data.mainBlock.models.forEach(function(t){var e=t.id;t.list.forEach(function(i,r){var s=i.url.indexOf("s.m.tmall.com")!==-1||i.url.indexOf("list.tmall.com")!==-1,c=t.type,u=Number.parseFloat(o(".tab-ul").width()),h=(u-u*.08)/3*.76,f=u-u*.08;if(s){i.url+=(i.url.indexOf("?")!==-1?"&":"?")+"from=nav_"+c.charAt(0)+c.charAt(c.length-1)+"_"+n+"_"+e+"_"+i.id}if(a.options.spm){i.url+=(i.url.indexOf("?")!==-1?"&":"?")+"spm="+a.options.spm+"."+e+"nav."+r}if(i.pic&&c==="bannerThinRect"){i.pic=l.getFitUrl(i.pic,f,f)}else if(i.pic){i.pic=l.getFitUrl(i.pic,h,h)}})});return t}},{key:"_refresh",value:function n(){var t=this;t.$active=o("#J_tabNav .active");t.$cloneTop.html(t.$active.html());t.$cloneBottom.html(t.$active.html());t.current=Number.parseInt(t.$active.attr("data-index"),10);if(t.current>0){t.$cloneTop.removeClass("show");t.$cloneBottom.addClass("show")}else{t.$cloneTop.addClass("show");t.$cloneBottom.removeClass("show")}t.$menu.scrollTop(0);t.$nav.trigger("scroll")}},{key:"_initContainer",value:function s(){var t=this,e=u({isShowLink:t.options.isShowLink,title:t.options.title}),n={api:"com.taobao.tmallsearch.service.TmallNavService",v:"1.0",ecode:0,data:{ver:1,rootName:t.options.channel}},a=t._getTtid();if(a){n.ttid=a}t.$containerEl=o(e);o("body").append(t.$containerEl);c.request(n).then(function(e){e=t._dealData(e);e=t.options.navCallback(e);var n=d({data:e.data.sideBlock.list}),a=f({data:e.data.sideBlock.list});t.$navUl.html(n);t.$menuUl.html(a);t._refresh();t._initScroll();t._getActiveContent(e)},function(e){t.trigger("error",e.ret.join(";"))})}},{key:"_initDom",value:function $(){var t=this;t.$tab=o("#J_tab");t.$header=t.$tab.find("#J_tabHeader");t.$content=t.$tab.find("#J_tabContent");t.$nav=t.$tab.find("#J_tabNav");t.$navUl=t.$tab.find("#J_tabNav ul");t.$menu=t.$tab.find("#J_tabMenu");t.$menuUl=t.$tab.find("#J_tabMenu .tab-ul");t.$cover=t.$tab.find("#J_tabCover");t.$cloneTop=t.$tab.find("#J_tabCloneTop");t.$cloneBottom=t.$tab.find("#J_tabCloneBottom");t.$container=t.$tab.find("#J_tabContainer");t.$active=null}},{key:"_initClick",value:function _(){var t=this;t.$navUl.on(m,"li",function(e){var n=t.$navUl.children(),a=t.$menuUl.children(),i=o(e.target),r=i.siblings(),l=Number.parseInt(i.attr("data-index"),10),s=a.eq(l),c=s.siblings(),u=s.data("data-flag"),h={curNav:i.get(0),curMenu:s.get(0)};r.removeClass("active");i.addClass("active");c.removeClass("active");s.addClass("active");t._refresh();t.trigger("switch",h);if(l>0){n.eq(0).css("visibility","visible")}else{n.eq(0).css("visibility","")}if(!u){t._getContent(l)}})}},{key:"_getActiveContent",value:function g(t){var e=this,n=h({data:t.data.mainBlock.models}),a=Number.parseInt(e.$active.attr("data-index"),10),i=e.$menuUl.children(),o=i.eq(a);o.html(n);o.data("data-flag",true)}},{key:"_getContent",value:function b(t){var e=this,n=e.$navUl.children(),a=e.$menuUl.children(),i=n.eq(t),o=a.eq(t),r=i.attr("data-id"),l=e._getTtid(),s={api:"com.taobao.tmallsearch.service.TmallNavService",v:"1.0",ecode:0,data:{ver:1,rootName:e.options.channel,catId:r}};if(l){s.ttid=l}c.request(s).then(function(t){t=e._dealData(t,r);t=e.options.contentCallback(t);var n=t.data.mainBlock.models,a=h({data:n});o.html(a);o.data("data-flag",true)},function(t){e.trigger("error",t.ret.join(";"))})}},{key:"_initScroll",value:function y(){var t=this,e=t.$content.offset().height;t.$nav.on("scroll",function(){if(-(t.$navUl.offset().top-44)>t.current*60||t.current===0){t.$cloneTop.addClass("show")}else{t.$cloneTop.removeClass("show")}if(t.$active.offset().top-44>e-60&&t.current!==0){t.$cloneBottom.addClass("show")}else{t.$cloneBottom.removeClass("show")}})}},{key:"_contentWidth",value:function C(){var t=this,e=o(v).width();t._width=e-35;t._transform(-t._width+"px");t.$container.width(t._width);o(v).on("resize",function(){t._width=o(v).width()-35;t.$container.width(t._width)})}},{key:"_hashChange",value:function k(){var t=this;o(v).on("hashchange",function(){if(v.location.hash===t.options.hash&&t.status!=="open"){t.open()}else if(!v.location.hash&&t.status!=="close"){t.close()}})}},{key:"open",value:function w(){var t=this;t._goNative(function(){if(t.status!=="open"){if(!t.isFirstOpen){t._initContainer();t._initDom();t._contentWidth();t._initClick();t._initClose();t._hashChange();t.isFirstOpen=true}t.$container.show();t.$cover.show();t._transform("0");t.status="open";if(v.location.hash!==t.options.hash){v.location.hash=t.options.hash}}});return t}},{key:"close",value:function x(){var t=this,e=void 0;if(t.status!=="close"){t._transform(-t._width+"px");t.$container.on(p,e=function n(){t.$cover.hide();t.$container.hide();t.$container.off(p,e)});t.status="close";if(v.location.hash===t.options.hash){if(v.history.length&&v.history.length>1){v.history.back()}else{v.history.replaceState&&v.history.replaceState(null,document.title,v.location.href.replace(t.options.hash,""))}}}return t}},{key:"_transform",value:function T(t){var e=this;e.$container.offset();e.$container.css({"-webkit-transform":"translateX("+t+")",transform:"translateX("+t+")"})}},{key:"_initClose",value:function N(){var t=this;t.$cover.on("touchstart",function(t){t.preventDefault()});t.$cover.on(m,function(e){e.stopPropagation();t.close()});t.$tab.on("swipeLeft",function(){t.close()})}},{key:"_getTtid",value:function U(){if(!this._ttid){this._ttid=this._getParameter("ttid")}return this._ttid}},{key:"_getParameter",value:function B(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i");var n=v.location.search.substr(1).match(e);return n!=null?decodeURIComponent(RegExp.$2):null}},{key:"_compareVersion",value:function J(t,e){var n=t.split(".");var a=e.split(".");var i=Math.max(n.length,a.length);for(var o=0;o<i;o++){if(n[o]===undefined){return false}else if(a[o]===undefined){return true}else if(n[o]-0<a[o]-0){return false}else if(n[o]-0>a[o]-0){return true}}return true}},{key:"_goNative",value:function E(t){var e=this;if(e.options.nativeConfig.open){r.ready(function(){var n=r.appinfo.name,a=r.appinfo.ver,i=e.options.nativeConfig,o=n==="tmall"&&e._compareVersion(a,i["tmall"])||n==="taobao"&&e._compareVersion(a,i["taobao"]);if(o){v.location.href="//s.m.tmall.com/m/category.htm?spm="+e.options.spm+".navtab.1&businessName="+(i.channel?i.channel:e.options.channel)}else{t()}})}else{t()}}}]);return t}();Object.assign($.prototype,s);n.exports=$});