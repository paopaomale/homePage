define("mui/datalazyload/index",function(t,e,n){var o=t("mui/zepto/zepto");var i=t("mui/zepto/event");var r=window,a=r.document,f="data-ks-lazyload",c="ks-datalazyload",l="-custom",u="default",d="none",s="scroll",g="touchmove",m="resize",h=100,p=0,v=navigator.userAgent.match(/iPad|iPod|iPhone/),y;function b(t){return Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object Array]"}function _(t){return t.nodeType===1||t.nodeType===9}function w(t){if(typeof t.getDOMNodes==="function"){t=t.getDOMNodes()}t=b(t)?t:[t];return t.reduce(function(t,e){if(!e)return t;if(b(e)){return t.concat(w(e))}else if(_(e)){return t.concat(e)}else if(!e.tagName&&e.length&&typeof e==="object"){return t.concat(w(Array.prototype.slice.call(e)))}else if(typeof e==="string"){return t.concat(F(e))}else if(typeof e.get==="function"){e=e.get();return t.concat(e?w(e):void 0)}return t},[])}function A(t){var e=document.createElement("style");document.head.appendChild(e);if(e.styleSheet){e.styleSheet.cssText=t}else{e.appendChild(a.createTextNode(t))}}function k(t,e){var n="",o;try{if(o=document.defaultView.getComputedStyle(t,null)){n=o.getPropertyValue(e)||o[e]}}catch(i){}try{if(n===""){n=t.currentStyle[e]}}catch(i){}if(n===""){n=t.style[e]}return n}function S(t,e,n){i(t).on(e,n)}function C(t,e,n){i(t).off(e,n)}function H(t,e){return F(t,e)[0]}function F(t,e){if(typeof t!=="string"){t=w(t);return t}return o(e||document).find(t).get()}function E(t,e,n){return o(t).html(e)}function R(){var t=window,e=t.document,n=t.pageXOffset;return(t.pageYOffset||0)*1+(e.documentElement.scrollLeft||0)*1+(e.body.scrollLeft||0)*1}function D(){var t=window,e=t.document;return(t.pageXOffset||0)*1+(e.documentElement.scrollTop||0)*1+(e.body.scrollTop||0)*1}function T(){var t=window,e=t.document,n=e.body,o=e.documentElement;return t.innerWidth||e.compatMode==="CSS1Compat"&&o.clientWidth||n&&n.clientWidth||o.clientWidth}function I(){var t=window,e=t.document,n=e.body,o=e.documentElement;return t.innerHeight||e.compatMode==="CSS1Compat"&&o.clientHeight||n&&n.clientHeight||o.clientHeight}function x(t){if(t.nodeType==9){return Math.max(document.document.documentElement.scrollWidth||0,document.body.documentElement.scrollWidth||0,T())}var e=t.offsetWidth;if(e>0){return e}e=k(t,"width");if(e==null||Number(e)<0){e=t.style.width||0}e=parseFloat(e)||0;e+=parseFloat(k(t,"paddingLeft"))||0;e+=parseFloat(k(t,"borderLeftWidth"))||0;e+=parseFloat(k(t,"paddingRight"))||0;e+=parseFloat(k(t,"borderRightWidth"))||0;return e}function M(t){if(t.nodeType==9){return Math.max(document.document.documentElement.scrollHeight||0,document.body.documentElement.scrollHeight||0,I())}var e=t.offsetHeight;if(e>0){return e}e=k(t,"height");if(e==null||Number(e)<0){e=t.style.height||0}e=parseFloat(e)||0;e+=parseFloat(k(t,"paddingTop"))||0;e+=parseFloat(k(t,"borderTopHeight"))||0;e+=parseFloat(k(t,"paddingBottom"))||0;e+=parseFloat(k(t,"borderBottomHeight"))||0;return e}function L(t){var e=R(),n=D();if(t.getBoundingClientRect){var o=t.getBoundingClientRect(),i=document,r=i.body,a=i&&i.documentElement,f=window.getComputedStyle&&window.getComputedStyle(t).zoom||1;e+=o.left*f-(a.clientLeft||r.clientLeft||0);n+=o.top*f-(a.clientTop||r.clientTop||0)}return{left:e,top:n}}function W(t){var e,n,o=[],i;return function(r,a){if(a!==0&&!a){a=1}if(a&1&&!n){n=true;t(function(t){e=t;while(i=o.shift()){try{i&&i.apply(null,[e])}catch(n){setTimeout(function(){throw n},0)}}})}if(e){r&&r.apply(null,[e]);return e}if(!(a&2)){r&&o.push(r)}return e}}function O(t,e,n){var o,i=0,r=0,e=e||150;function a(){if(o){o.cancel();o=0}i=+new Date;t.apply(n||this,arguments);r=+new Date}function f(t,e){var n=setTimeout(t,e);return{cancel:function(){clearTimeout(n)}}}var c=function(){var t=arguments;if(!i||r>=i&&+new Date-r>e||r<i&&+new Date-i>e*8){a()}else{if(o){o.cancel()}o=f(function(){a.apply(null,t)},e)}};c.stop=function(){if(o){o.cancel();o=0}};return c}function N(t,e,n){var o=t.length;function i(){o?t[--o].call(null,e,i):n(e)}i()}function z(t,e,n){if(!t.offsetWidth&&!t.offsetHeight){return false}var o=L(t),i=window.getComputedStyle&&window.getComputedStyle(t).zoom||1,r=true,a,f=o.left,c=o.top,l={left:f,top:c,right:f+x(t)*i,bottom:c+M(t)*i};a=j(e,l);if(a&&n){r=j(n,l)}return r&&a}function B(t){if(/^(loaded|complete)$/.test(document.readyState)){return t()}if(window.addEventListener){return window.addEventListener("load",t,false)}if(window.attachEvent){return window.attachEvent("onload",t)}}function P(t){var e=["webkit",""],n=a.createElement("div"),o=e.length;for(var o=0,i=e.length;o<i;o++){if(!e[o]){t=t.toLowerCase()}if(n.style[e[o]+t]!==undefined){return true}}return false}function V(t,e){var n=this;if(!(n instanceof V)){return new V(t,e)}var o=t;if(!t||(t.nodeType||typeof t==="string"||typeof t.get==="function"||t.getDOMNode)){o=e||{};if(t){o.container=t}}n.set("diff",u);n.set("placeholder",window.ActiveXObject&&!document.documentMode?"//g.alicdn.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==");n.set("execScript",true);n.set("fade",false);n.set("diff",u);n.set("autoDestroy",true);for(var i in o){if(!o.hasOwnProperty(i)){continue}n.set(i,o[i])}if(!n.get("container")){n.set("container",document.body)}n._diffRatio=0;n._callbacks={};n._startLis=[];n._containerIsNotDocument=n.get("container").nodeType!=9&&n.get("container")!==document.body&&n.get("container").nodeType;n._fade=P("Animation")&&!(/Android (\d+\.\d+)/i.test(r.navigator.userAgent)&&parseFloat(RegExp["$1"])<4.3);if(b(o.container)){n._backCompact=1}n["_initLoadEvent"]();o.container&&n.addElements(o.container);n.resume();S(document,"DOMContentLoaded",n._loadFn);B(function(){n._diffRatio=Math.max(v?2:1,n._diffRatio);n._loadFn()});n._inited=true}function j(t,e){var n={};n.top=Math.max(t.top,e.top);n.bottom=Math.min(t.bottom,e.bottom);n.left=Math.max(t.left,e.left);n.right=Math.min(t.right,e.right);return n.bottom>=n.top&&n.right>=n.left}V.prototype={get:function(t){return this["ATTR_"+t]},set:function(t,e){this["ATTR_"+t]=e},addStartListener:function(t){var e=this._startLis;if(!t){return}for(var n=e.length-1;n>=0;n--){if(e[n]==t){return}}e.push(t)},_initLoadEvent:function(){var e=this;e.addStartListener(function(t,n){var o=e.get("onStart");if(o){var i=o.apply(this,arguments);if(i===true||i===false){t.returnValue=i}}n()});e.addStartListener(function(n,o){if(n.type!="img"){o();return}var i=e.get("webpReplacer");if(typeof i=="function"){t(["mui/datalazyload/webp"],function(t){t.isSupport(function(t){if(t){n.src=i(n.src)}o()})})}else{o()}});e.imgHandle=function(){var t=this,n=e.get("imgFlag")||f,i=t.getAttribute(n);if(!i){return}N(e._startLis,{type:"img",elem:t,src:i},function(i){if(i.returnValue===false){return}if(i.src&&t.src!=i.src){if(e.isFade){var r="img-ks-lazyload",a="img-ks-beforeload";o(t).addClass(a);function f(){C(t,"load",f);o(t).removeClass(a);o(t).addClass(r);e.refresh()}S(t,"load",f)}t.src=i.src}t.removeAttribute(n)})};e.bgimgHandle=function(){var t=this,n=(e.get("imgFlag")||f)+"-bg",o=t.getAttribute(n);if(!o){return}N(e._startLis,{type:"bgimg",elem:t,bgimgSrc:o},function(e){if(e.returnValue===false){return}if(e.bgimgSrc){var o=t&&t.filters,i,r;try{i=o&&o.item("DXImageTransform.Microsoft.AlphaImageLoader");r=o&&o.item("DXImageTransform.Microsoft.Matrix")}catch(a){}if(i){i.src=e.bgimgSrc;i.enabled=true;function f(t,e){var n=new Image;n.style.position="absolute";n.style.visibility="visible";n.onload=n.onerror=function(){e(n);document.body.removeChild(n);n=null};document.body.appendChild(n);n.src=t}if(!r||!t.offsetWidth||!t.offsetHeight){return}f(e.bgimgSrc,function(e){if(!e.offsetWidth||!e.offsetHeight){return}var n=t.currentStyle["background-size"]=="cover"?"cover":"contain";if(e.offsetHeight/e.offsetWidth>t.offsetHeight/t.offsetWidth===(n=="contain")){r.M11=t.offsetHeight*e.offsetWidth/(t.offsetWidth*e.offsetHeight);r.M22=1;r.Dx=t.offsetWidth*(1-r.M11)/2;r.Dy=0}else{r.M11=1;r.M22=t.offsetWidth*e.offsetHeight/(t.offsetHeight*e.offsetWidth);r.Dx=0;r.Dy=t.offsetHeight*(1-r.M22)/2}r.enabled=true})}else{t.style.backgroundImage="url("+e.bgimgSrc+")"}}t.removeAttribute(n)})};e.textareaHandle=function(){var t=this;t.style.display=d;t.className="";var n=document.createElement("div");t.parentNode.insertBefore(n,t);N(e._startLis,{type:"textarea",elem:t,value:t.value},function(t){if(t.returnValue===false){return}E(n,t.value,e.get("execScript"));e.addElements(n);e.refresh()})};e._loadFn=O(function(){if(e._inited&&e._started&&e.get("autoDestroy")){var t=e._callbacks,n=true;for(var o in t){if(t.hasOwnProperty(o)&&t[o]!==undefined){n=false;break}}if(n){e.destroy()}}if(!e._started){return}e["_loadItems"]()},h,e);e._onScroll=function(t){e._diffRatio=Math.max(v?4:2,e._diffRatio);e._loadFn()}},refresh:function(){this._loadFn()},_loadItems:function(){var t=this,e=t.get("container"),n=t._callbacks;if(t._containerIsNotDocument&&!e.offsetWidth){return}t._windowRegion=t["_getBoundingRect"]();if(!t._backCompact&&t._containerIsNotDocument){t._containerRegion=t["_getBoundingRect"](t.get("container"))}for(var o in n){if(!n.hasOwnProperty(o)){continue}var i=n[o];i&&t._loadItem(o,i)}},_loadItem:function(t,e){var n=this,e=e||n._callbacks[t];if(!e){return true}if(n._lastDiff!=n.get("diff")){n._windowRegion=n["_getBoundingRect"]();if(!n._backCompact&&n._containerIsNotDocument){n._containerRegion=n["_getBoundingRect"](n.get("container"))}n._lastDiff=n.get("diff")}var o=e.el,i=false,r=e.fn;if(n.get("force")||z(o,n._windowRegion,n._containerRegion)){try{i=r.call(o)}catch(a){setTimeout(function(){throw a},0)}}if(i!==false){delete n._callbacks[t]}return i},addCallback:function(t,e){t=H(t);var n=this,o=n._callbacks,i={el:t||document,fn:e||function(){}},r=++p;o[r]=i;if(n._windowRegion){n._loadItem(r,i)}else{n.refresh()}return r},removeCallback:function(t,e){t=H(t);var n=this._callbacks;for(var o in n){if(!n.hasOwnProperty(o)){continue}var i=n[o];if(i.el==t&&(e?i.fn==e:1)){delete n[o]}}},getElements:function(){var t=this,e=[],n=[],o=t._callbacks;for(var i in o){if(!o.hasOwnProperty(i)){continue}var r=o[i];if(r.fn==t.imgHandle){e.push(r.el)}if(r.fn==t.textareaHandle){n.push(r.el)}}return{images:this._images,textareas:this._textareas}},addElements:function(t,e){t=w(t);var n=this;n._addStyle();function o(t){return function(e){if(!t.src){t.src=e}}}function i(t){return function(){setTimeout(function(){n._loadItem(t)},0)}}for(var r=0;r<t.length;r++){var a=t[r];if(!a){return}if(!e||e==="img"){var l=[a].concat(F("img",a));for(var u=0;u<l.length;u++){var d=l[u];if(!(d.getAttribute&&d.getAttribute(n.get("imgFlag")||f))){continue}var s=n.addCallback(d,n.imgHandle);if(!d.offsetWidth){d.onload=d.onerror=i(s);if(!d.src){n.onPlaceHolder=W(function(t){var e=n._phImg=new Image,o=n.get("placeholder");e.onload=e.onerror=function(){t(o)};e.src=o});n.onPlaceHolder(o(d))}}}}if(!e||e==="bgimg"){var g=(n.get("imgFlag")||f)+"-bg",l=[a].concat(F("["+g+" ]",a));for(var u=0;u<l.length;u++){var d=l[u];if(d.getAttribute&&d.getAttribute(g)){n.addCallback(d,n.bgimgHandle)}}}if(!e||e==="textarea"){var m=F("textarea."+(n.get("areaFlag")||c),a);for(var s in m){n.addCallback(m[s],n.textareaHandle)}}}},removeElements:function(t){t=w(t);var e=this,n=e._callbacks;for(var o in n){if(!n.hasOwnProperty(o)){continue}var i=n[o].el,r=false;for(var a=t.length-1;a>=0;a--){if(t[a]==i){delete n[o];r=true;break}}if(r){break}}},_getBoundingRect:function(t){var e,n,o,i;if(t!==undefined){e=M(t);n=x(t);var r=L(t);o=r.left;i=r.top}else{e=I();n=T();o=R();i=D()}var a=this.get("diff"),f=this._diffRatio;if(a===u){a={left:0,top:0,right:n*f,bottom:e*f}}else if(typeof a!=="object"){a={left:a,top:a,right:a,bottom:a}}return{left:o-(a.left||0),top:i-(a.top||0),right:o+n+(a.right||0),bottom:i+e+(a.bottom||0)}},pause:function(){var t=this,e=t._onScroll,n=t._loadFn;if(t._destroyed||!t._started){return}C(r,s,e);C(r,g,e);C(r,m,n);n.stop();if(t._containerIsNotDocument){var o=t.get("container");C(o,s,e);C(o,g,e)}t._started=false},resume:function(){var t=this,e=t._onScroll,n=t._loadFn;if(t._destroyed||t._started){return}S(r,s,e);S(r,g,e);S(r,m,n);if(t._containerIsNotDocument){var o=t.get("container");S(o,s,e);S(o,g,e)}t._started=true;t._loadFn()},destroy:function(){var t=this;t.pause();t._callbacks={};t._destroyed=1},_addStyle:function(){var t=this;if(t._fade){t.isFade=t.get("fade");if(t.isFade&&!y){y=true;A("@-webkit-keyframes ks-fadeIn{0%{opacity:0}100%{opacity:1}}"+"@keyframes ks-fadeIn{0%{opacity:0}100%{opacity:1}}"+".img-ks-lazyload{-webkit-animation:ks-fadeIn 350ms linear 0ms 1 normal both;animation:ks-fadeIn 350ms linear 0ms 1 normal both;opacity:1}"+".img-ks-beforeload{opacity:0}")}}}};function X(t,e,n,o){if(e==="img-src"){e="img"}if(!b(t)){t=[H(t)]}var i=new V(a,{});i.set("imgFlag",n||f+l);i.set("areaFlag",n||c+l);i.set("onStart",o);i.set("force",true);i.addElements(t,e)}V.loadCustomLazyData=X;var $;V.instance=function(){return $||($=new V(null,{autoDestroy:false}))};n.exports=V});