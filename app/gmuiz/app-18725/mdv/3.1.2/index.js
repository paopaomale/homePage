KISSY.add("mui/mdv/index",function(S){function createLoader(e,t){var n,r,o=[];function i(e,r){if(typeof n!=="object"&&n===e){return}if(typeof r==="number"){t=r;a.set=t&4?i:null}n=e;if(n===undefined){return}for(var u=0,f=o.length;u<f;u++){var d=o[u]&&o[u][0]&&o[u][0].apply(null,[n,t]);if(!(t&2)||!(o[u][1]&2)||!o[u]||!o[u][0]||d===false){o.splice(u,1);u--;f--}}}function a(a,u){if(typeof u!=="number"){u=1}if(u&1&&!r){r=true;e(i)}var f=n===undefined;if(!f){if(a&&a.apply(null,[n,t])===false){a=null}}if(a&&(f||u&2&&t&2)){o.push([a,u])}return n}t=t||0;if(t&1&&!r){r=true;e(i)}a.get=function(){return n};a.set=t&4?i:null;a.onChange=function(e,t){return a(e,(typeof t==="number"?t:1)|2)};a.onLoad=a;return a}function createBridge(e,t,n){var r=e.onLoad?function(t){t(e)}:createLoader(e);function o(e,n){var o,i=this;r(function(r){var a=r.apply(i,[t?function(n){t(n,function(t){o=t;e&&e(o)})}:e,n])});return o}o.get=function(){var e;r(function(n){t?t(n.get(),function(t){e=t}):e=n.get()});return e};o.set=function(e){r(function(r){if(t&&!n){throw new Error}n?n(e,r.get(),function(e){r.set(e)}):r.set(e)})};o.onChange=function(e,t){return o(e,(typeof t==="number"?t:1)|2)};o.onLoad=o;return o}function onParallelLoad(e,t,n){var r=this,o=new Array(e.length),i;function a(e,n){o[n]=e;for(i=o.length-1;i>=0;i--){if(o[i]===undefined){break}}if(i<0){try{t&&t.apply(null,o)}catch(r){setTimeout(function(){throw r},0)}}}function u(e,t){if(e.onLoad){e.onLoad(function(e){a(e,t)},n)}else{r.onModLoad(e,function(e){a(e,t)},n)}}for(var f=0;f<e.length;f++){u(e[f],f)}}function onParallelChange(e,t,n){return onParallelLoad.apply(this,[e,t,(typeof n=="number"?n:1)|2])}function onParallelMap(e,t,n,r){var o=S.keys(e).length,i=S.isArray(e)?new Array(o):{};S.each(e,function(e,a){var u=t.length,f=new Array(u);S.each(t,function(t,d){e.onModLoad(t,function(t){f[d]=t;if(--u===0){i[a]=n?n.apply(e,f):f;if(--o===0){r(i)}}},8)})})}function Mdv(){}Mdv.prototype={preload:function(e,t){return createLoader(e,(t||0)|1)},createLoader:createLoader,createBridge:createBridge,onParallelLoad:onParallelLoad,onParallelChange:onParallelChange,onParallelMap:onParallelMap,define:function(e,t,n){if(!e||!t){return}var r=this;r._modDef=r._modDef||createLoader(function(e){e([])},6);r._modDef.onLoad(function(o){o.push({filter:e,creator:t,level:n||0});o.sort(function(e,t){return e.level-t.level});r._modDef.set(o)})},onModCreate:function(e,t,n){var r=this,o,i;if(!e||typeof e=="undefined"||typeof e=="boolean"||typeof e=="number"||typeof e=="string"){o=r._modMap||(r._modMap={});i=e}else{o=e;i="_mdvMod"}o[i]=o[i]||(o[i]=createLoader(function(t){r._modDef=r._modDef||createLoader(function(e){e([])},6);r._modDef.onChange(function(n){for(var r=n.length-1;r>=0;r--){var o,i=n[r].filter;if(typeof i=="function"){o=i(e)}else if(i&&typeof i.test=="function"){o=i.test(e)}else{o=i===e}if(o){if(n[r].creator.onChange){var a=n[r].creator;n.splice(r,1);t(a)}else{var u=n[r].creator(e);t(u)}return false}}console.log("[MDV]mod ",e,"not found!,hang up!")},3)}));o[i](t,n)},onModInit:function(e,t,n){this.onModCreate(e,function(e){if(e._mdvInit){e._mdvInit(t,n)}else{t()}},n)},onModLoad:function(e,t,n){var r=this;if(typeof e=="string"&&e.indexOf(",")>=0){e=e.split(/\s*,\s*/)}if(e instanceof Array){return onParallelLoad.apply(r,[e,t,n])}this.onModCreate(e,function(e){e.onLoad(t,n)},n)},onModChange:function(e,t,n){this.onModLoad(e,t,(n===0||n?n:1)|2)},onModCallback:function(e,t,n){this.onModLoad(e,t,n)},addAlias:function(e,t){var n=this;return n.addBridge(e,n,t)},addBridge:function(e,t,n){var r=this;r.define(e,createBridge(function(e){t.onModCreate(n,e)}),8)},getBridge:function(e,t){var n=this;return e?createBridge(function(t){n.onModCreate(e,t)}):t?createLoader(function(e){e(t)}):null}};var mdv;Mdv.instance=function(){if(!mdv){mdv=new Mdv;function createModule(e,t,n,r){var o=createLoader(function(t){o._mdvInit(function(n){var r=n.loader||function(t,n){var r=t.name.replace(/index(?:\.js)?$/,"");S.use(r,function(r,o){if(o.initView){return o.initView(null,t.cfg,e,n)}if(o.init){o.init(t.cfg)}n(o)})};r(n,t)})});o._mdvInit=createLoader(function(e){e({name:t,cfg:r||{},loader:n})});return o}function createElement(mdv,el,modCls,cfg){var mod=createLoader(function(e){mod._mdvInit(function(t){var n=t.cfg,r=t.cls.replace(/index(?:\.js)?$/,"");S.each(n,function(e){var t=e&&e.mdvPrep;if(!t){return}switch(t){case"loadJsonp":e.preload=createLoader(function(t){var n=window,r=e.callback||S.guid("jsonp"),o=r;while(o.indexOf(".")>0){var i=o.substring(0,o.indexOf("."));n=n[i]||(n[i]={});o=o.substring(o.indexOf(".")+1)}n[o]=t;var a=["callback="+r,"t="+ +new Date];S.each(e.param,function(e,t){a.push(t+"="+encodeURIComponent(e))});S.getScript(e.url+a.join("&"),{error:t})},1)}});detectCss(r+"index.css");S.use(r,function(t,r){r.initView(el,n,mdv,e)})})});mod._mdvInit=createLoader(function(callback){S.use("dom",function(S,DOM){if(!/\s+t(m|b)-\S+/.test(DOM.attr(el,"class"))&&DOM.parent(el,".tb-shop")){return}var modCfg=DOM.attr(el,"mdv-cfg");DOM.removeAttr(el,"mdv-cfg");try{if(/^mdv/.test(modCfg)){modCfg=window[modCfg]||{}}else{modCfg=modCfg?eval("("+modCfg+")"):{}}}catch(err){modCfg={};setTimeout(function(){throw err},0)}S.mix(modCfg,cfg);callback({el:el,cls:modCls,cfg:modCfg})})});return mod}function detectCss(e){try{var t=document.createElement("div");t.className="mdv1-"+e.replace(/\.css$/,"").replace(/\W+/g,"_");t.style.visibility="hidden";t.style.position="absolute";var n=document.body;if(!n){return}n.insertBefore(t,n.firstChild);if(Math.round(t.offsetHeight/7)==1){S.add(e,function(){return 1})}if(!window.ActiveXObject||document.documentMode&&document.documentMode>8){var r=window.getComputedStyle(t,":before").content;if(r){S.each(r.split(","),function(e){S.add(e+".css",function(){return 1})})}}n.removeChild(t)}catch(o){setTimeout(function(){throw o},0)}}mdv.detectCss=detectCss;mdv.onDatalazyload=createLoader(function(e){S.use("mui/datalazyload/",function(t,n){var r=n.instance&&n.instance()||new n(document.body,{autoDestroy:false});e(r)})});mdv.addModule=function(e,t,n){var r=this;r.define(function(t){return e===t},function(e){return createModule(r,e,t,n)},5)};var modelReg=/^([#%][^\.\|\s)]+)(?:\.([^\.\|\s]+)([^\|\s]*)((?:\s*\|[^\|]+)*))?$/;mdv.define(modelReg,function(name){var result=modelReg.exec(name),bridge=mdv.createBridge(function(e){if(result[2]){return mdv.onModCallback(result[1],function(t){t.onModCreate(result[2],e)})}var t=result[1].charAt(0)=="#"?document.getElementById(result[1].substring(1)):result[1].substring(1);if(!t){setTimeout(function(){throw"[MDV] dom "+result[1]+" not exists!"},0)}return mdv.onModCreate(t,e)},result[3]&&function(value,callback){var v;try{v=eval("(value"+result[3]+")")}catch(err){setTimeout(function(){throw"eval error: (value"+result[3]+")";throw err},0)}callback(v===undefined?null:v)},result[3]&&function(v,value,callback){try{eval("value"+result[3]+"=v")}catch(err){setTimeout(function(){throw"eval error: value"+result[3]+"=v";throw err},0)}callback(value)});function filter(bridge,filterStr){var filterResult=/^\s*([#%][^\.\|\s)]+)\.([^\.\|\s]+)(.*)$/.exec(filterStr);function getParam(str){var v;try{v=eval("("+str+")")}catch(err){setTimeout(function(){throw"eval error: ("+str+")";throw err},0)}return v}return mdv.createBridge(function(e){mdv.onModLoad(filterResult[1],function(t){var n=[bridge],r,o=/\s+([^\s'"]*(?:(['"]).*?\2)*[^\s'"]*)(?=\s|$)/gi;while(r=o.exec(filterResult[3])){if(r[1]){n.push(getParam(r[1]))}}e(t[filterResult[2]].apply(t,n))})})}if(result[4]){var filterReg=/\s*\|([^|]+)*(?=$|\|)/gi,filterResult;while(filterResult=filterReg.exec(result[4])){bridge=filter(bridge,filterResult[1])}}return bridge});mdv.define(function(e){return typeof e=="string"},function(e){return createModule(mdv,e)},-5);mdv.addElement=function(e,t,n){var r=this;function o(e,t){if(S.isArray(e)){return S.each(e,t)}if(typeof e==="string"){S.use("dom",function(n,r){n.each(r.query(e),t)});return}return t(e)}o(e,function(e){if(e.mdvInited){return}for(var o=e.parentNode;o;o=o.parentNode){if(o.getAttribute&&o.getAttribute("mdv-raw")){return}}e.mdvInited=true;var i=t||e.getAttribute("mdv-cls");r.define(function(t){return e===t},function(e){return createElement(r,e,i,n)},5);if(i){r.addAlias(i,e)}r.onDatalazyload(function(t){t.addCallback(e,function(){S.use("dom",function(t,n){if(n.css(e,"display")=="none"){return false}r.onModCallback(e)})})})})}}return mdv};return Mdv});