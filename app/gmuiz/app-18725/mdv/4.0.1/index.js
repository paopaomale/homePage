define("mui/mdv/index",function(require,exports,module){var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol?"symbol":typeof e};var getScript=require("mui/mdv/util/getScript");var guid=require("mui/mdv/util/guid");var $=require("mui/zepto/zepto");var def=define;function createLoader(e,t){var n,r,o=[];function i(e,r){if((typeof n==="undefined"?"undefined":_typeof(n))!=="object"&&n===e){return}if(typeof r==="number"){t=r;a.set=t&4?i:null}n=e;if(n===undefined){return}for(var u=0,f=o.length;u<f;u++){var d=o[u]&&o[u][0]&&o[u][0].apply(null,[n,t]);if(!(t&2)||!(o[u][1]&2)||!o[u]||!o[u][0]||d===false){o.splice(u,1);u--;f--}}}function a(a,u){if(typeof u!=="number"){u=1}if(u&1&&!r){r=true;e(i)}var f=n===undefined;if(!f){if(a&&a.apply(null,[n,t])===false){a=null}}if(a&&(f||u&2&&t&2)){o.push([a,u])}return n}t=t||0;if(t&1&&!r){r=true;e(i)}a.get=function(){return n};a.set=t&4?i:null;a.onChange=function(e,t){return a(e,(typeof t==="number"?t:1)|2)};a.onLoad=a;return a}function createBridge(e,t,n){var r=e.onLoad?function(t){t(e)}:createLoader(e);function o(e,n){var o,i=this;r(function(r){var a=r.apply(i,[t?function(n){t(n,function(t){o=t;e&&e(o)})}:e,n])});return o}o.get=function(){var e;r(function(n){t?t(n.get(),function(t){e=t}):e=n.get()});return e};o.set=function(e){r(function(r){if(t&&!n){throw new Error}n?n(e,r.get(),function(e){r.set(e)}):r.set(e)})};o.onChange=function(e,t){return o(e,(typeof t==="number"?t:1)|2)};o.onLoad=o;return o}function onParallelLoad(e,t,n){var r=this,o=new Array(e.length),i;function a(e,n){o[n]=e;for(i=o.length-1;i>=0;i--){if(o[i]===undefined){break}}if(i<0){try{t&&t.apply(null,o)}catch(r){setTimeout(function(){throw r},0)}}}function u(e,t){if(e.onLoad){e.onLoad(function(e){a(e,t)},n)}else{r.onModLoad(e,function(e){a(e,t)},n)}}for(var f=0;f<e.length;f++){u(e[f],f)}}function onParallelChange(e,t,n){return onParallelLoad.apply(this,[e,t,(typeof n=="number"?n:1)|2])}function onParallelMap(e,t,n,r){var o=Object.keys(e),i=$.isArray(e)?new Array(o):{};$.each(e,function(e,a){var u=t.length,f=new Array(u);$.each(t,function(t,d){a.onModLoad(d,function(d){f[t]=d;if(--u===0){i[e]=n?n.apply(a,f):f;if(--o===0){r(i)}}},8)})})}function Mdv(){}Mdv.prototype={preload:function e(t,n){return createLoader(t,(n||0)|1)},createLoader:createLoader,createBridge:createBridge,onParallelLoad:onParallelLoad,onParallelChange:onParallelChange,onParallelMap:onParallelMap,define:function t(e,n,r){if(!e||!n){return}var o=this;o._modDef=o._modDef||createLoader(function(e){e([])},6);o._modDef.onLoad(function(t){t.push({filter:e,creator:n,level:r||0});t.sort(function(e,t){return e.level-t.level});o._modDef.set(t)})},onModCreate:function n(e,t,r){var o=this,i,a;if(!e||typeof e=="undefined"||typeof e=="boolean"||typeof e=="number"||typeof e=="string"){i=o._modMap||(o._modMap={});a=e}else{i=e;a="_mdvMod"}i[a]=i[a]||(i[a]=createLoader(function(t){o._modDef=o._modDef||createLoader(function(e){e([])},6);o._modDef.onChange(function(n){for(var r=n.length-1;r>=0;r--){var o,i=n[r].filter;if(typeof i=="function"){o=i(e)}else if(i&&typeof i.test=="function"){o=i.test(e)}else{o=i===e}if(o){if(n[r].creator.onChange){var a=n[r].creator;n.splice(r,1);t(a)}else{var u=n[r].creator(e);t(u)}return false}}console.log("[MDV]mod ",e,"not found!,hang up!")},3)}));i[a](t,r)},onModInit:function r(e,t,n){this.onModCreate(e,function(e){if(e._mdvInit){e._mdvInit(t,n)}else{t()}},n)},onModLoad:function o(e,t,n){var r=this;if(typeof e=="string"&&e.indexOf(",")>=0){e=e.split(/\s*,\s*/)}if(e instanceof Array){return onParallelLoad.apply(r,[e,t,n])}this.onModCreate(e,function(e){e.onLoad(t,n)},n)},onModChange:function i(e,t,n){this.onModLoad(e,t,(n===0||n?n:1)|2)},onModCallback:function a(e,t,n){this.onModLoad(e,t,n)},addAlias:function u(e,t){var n=this;return n.addBridge(e,n,t)},addBridge:function f(e,t,n){var r=this;r.define(e,createBridge(function(e){t.onModCreate(n,e)}),8)},getBridge:function d(e,t){var n=this;return e?createBridge(function(t){n.onModCreate(e,t)}):t?createLoader(function(e){e(t)}):null}};var mdv;Mdv.instance=function(){if(!mdv){var modelReg;(function(){var createModule=function e(t,n,r,o){var i=createLoader(function(e){i._mdvInit(function(n){var r=n.loader||function(e,n){var r=e.name.replace(/index(?:\.js)?$/,"");require([r],function(r){if(r.initView){return r.initView(null,e.cfg,t,n)}if(r.init){r.init(e.cfg)}n(r)})};r(n,e)})});i._mdvInit=createLoader(function(e){e({name:n,cfg:o||{},loader:r})});return i};var createElement=function createElement(mdv,el,modCls,cfg){var mod=createLoader(function(e){mod._mdvInit(function(t){var n=t.cfg,r=t.cls.replace(/index(?:\.js)?$/,"");$.each(n,function(e,t){var n=t&&t.mdvPrep;if(!n){return}switch(n){case"loadJsonp":t.preload=createLoader(function(e){var n=window,r=t.callback||guid("jsonp"),o=r;while(o.indexOf(".")>0){var i=o.substring(0,o.indexOf("."));n=n[i]||(n[i]={});o=o.substring(o.indexOf(".")+1)}n[o]=e;var a=["callback="+r,"t="+ +new Date];$.each(t.param,function(e,t){a.push(e+"="+encodeURIComponent(t))});getScript(t.url+a.join("&"),function(t){t&&e(t)})},1)}});detectCss(r+"index.css");require([r],function(t){t.initView(el,n,mdv,e)})})});mod._mdvInit=createLoader(function(callback){var $el=$(el);if(!/\s+t(m|b)-\S+/.test($el.attr("class"))&&$el.closest(".tb-shop").length>0){return}var modCfg=$el.attr("mdv-cfg");$el.removeAttr("mdv-cfg");try{if(/^mdv/.test(modCfg)){modCfg=window[modCfg]||{}}else{modCfg=modCfg?eval("("+modCfg+")"):{}}}catch(err){modCfg={};setTimeout(function(){throw err},0)}$.extend(modCfg,cfg);callback({el:el,cls:modCls,cfg:modCfg})});return mod};var detectCss=function t(e){try{var t=document.createElement("div");t.className="mdv1-"+e.replace(/\.css$/,"").replace(/\W+/g,"_");t.style.visibility="hidden";t.style.position="absolute";var n=document.body;if(!n){return}n.insertBefore(t,n.firstChild);if(Math.round(t.offsetHeight/7)==1){def(e,function(){return 1})}if(!window.ActiveXObject||document.documentMode&&document.documentMode>8){var r=window.getComputedStyle(t,":before").content;if(r){$.each(r.split(","),function(e,t){def(t+".css",function(){return 1})})}}n.removeChild(t)}catch(o){setTimeout(function(){throw o},0)}};mdv=new Mdv;mdv.detectCss=detectCss;mdv.onDatalazyload=createLoader(function(e){require(["mui/datalazyload/"],function(t){var n=t.instance&&t.instance()||new t(document.body,{autoDestroy:false});e(n)})});mdv.addModule=function(e,t,n){var r=this;r.define(function(t){return e===t},function(e){return createModule(r,e,t,n)},5)};modelReg=/^([#%][^\.\|\s)]+)(?:\.([^\.\|\s]+)([^\|\s]*)((?:\s*\|[^\|]+)*))?$/;mdv.define(modelReg,function(name){var result=modelReg.exec(name),bridge=mdv.createBridge(function(e){if(result[2]){return mdv.onModCallback(result[1],function(t){t.onModCreate(result[2],e)})}var t=result[1].charAt(0)=="#"?document.getElementById(result[1].substring(1)):result[1].substring(1);if(!t){setTimeout(function(){throw"[MDV] dom "+result[1]+" not exists!"},0)}return mdv.onModCreate(t,e)},result[3]&&function(value,callback){var v;try{v=eval("(value"+result[3]+")")}catch(err){setTimeout(function(){throw"eval error: (value"+result[3]+")";throw err},0)}callback(v===undefined?null:v)},result[3]&&function(v,value,callback){try{eval("value"+result[3]+"=v")}catch(err){setTimeout(function(){throw"eval error: value"+result[3]+"=v";throw err},0)}callback(value)});function filter(bridge,filterStr){var filterResult=/^\s*([#%][^\.\|\s)]+)\.([^\.\|\s]+)(.*)$/.exec(filterStr);function getParam(str){var v;try{v=eval("("+str+")")}catch(err){setTimeout(function(){throw"eval error: ("+str+")";throw err},0)}return v}return mdv.createBridge(function(e){mdv.onModLoad(filterResult[1],function(t){var n=[bridge],r,o=/\s+([^\s'"]*(?:(['"]).*?\2)*[^\s'"]*)(?=\s|$)/gi;while(r=o.exec(filterResult[3])){if(r[1]){n.push(getParam(r[1]))}}e(t[filterResult[2]].apply(t,n))})})}if(result[4]){var filterReg=/\s*\|([^|]+)*(?=$|\|)/gi,filterResult;while(filterResult=filterReg.exec(result[4])){bridge=filter(bridge,filterResult[1])}}return bridge});mdv.define(function(e){return typeof e=="string"},function(e){return createModule(mdv,e)},-5);mdv.addElement=function(e,t,n){var r=this;function o(e,t){if($.isArray(e)){return $.each(e,t)}if(typeof e==="string"){console.log($(e));$(e).each(t);return}return t(null,e)}o(e,function(e,o){o=$(o)[0];if(!o||o.mdvInited){return}for(var i=o.parentNode;i;i=i.parentNode){if(i.getAttribute&&i.getAttribute("mdv-raw")){return}}o.mdvInited=true;var a=t||o.getAttribute("mdv-cls");r.define(function(e){return o===e},function(e){return createElement(r,e,a,n)},5);if(a){r.addAlias(a,o)}r.onDatalazyload(function(e){e.addCallback(o,function(){if($(o).css("display")=="none"){return false}r.onModCallback(o)})})})}})()}return mdv};module.exports=Mdv});