define("mui/city-selector/selector",function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=e("mui/zepto/zepto");e("mui/zepto/event");e("mui/zepto/touch");var u=e("mui/cover/sliding-menu/index");var a=e("mui/city-selector/selector.xtpl");var c=e("mui/city-selector/letterbar.xtpl");var s=e("mui/prompt/indicator/index");var l=e("mui/custom-event/index");e("mui/city-selector/selector.css");e("mui/babel-polyfill/index");var d="mui-city-selector";var m=function(){function t(e){var i=this;r(this,t);this.config=Object.assign({route:d},e);this.diff=0;this.cover=new u({headerContent:"\u57ce\u5e02\u9009\u62e9",bodyContent:"",className:d,route:this.config.route,hideHeaderInApp:true});this.cover.once("show",function(){s.getInstance().show();i.diff=i.cover.$el.find("header").hasClass("hide")?0:44;i.getData().then(function(e){var t;var n;var r={};r.letters=[];if(e.hotcities&&e.hotcities.length){r.letters.push({id:"hot",letter:"\u70ed\u95e8\u57ce\u5e02"})}e.areas=e.areas.filter(function(e){return e.cities&&e.cities.length>0});e.areas.forEach(function(e,t){r.letters.push({id:t,letter:e.letter})});t=a(e);n=c(r);i.cover.setBodyContent(t);i.cover.$el.append(n);i.bindTap();i.bindNav();i.bindDivisionChild();s.getInstance().hide()},function(){s.getInstance().hide();i.cover.setBodyContent('<div class="error">\u83b7\u53d6\u57ce\u5e02\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5</div>')})}).on("show",function(){i.trigger("show")}).on("hide",function(){i.trigger("hide");if(i.$divisionchildEl&&i.$divisionchildEl.length>0){i.$divisionchildEl.remove();delete i.$divisionchildEl}});this.bindTrigger()}n(t,[{key:"bindTrigger",value:function i(){var e=this;if(!this.config.trigger){return}var t=o(this.config.trigger);t.on("click",function(t){t.preventDefault();e.show()});this.on("currentCityChange",function(i){t.text(e.currentCity)})}},{key:"bindTap",value:function l(){var e=this;this.cover.$el.on("tap",".cities, .hot-cities-column",function(t){t.preventDefault();window.goldlog&&window.goldlog.record("/tbchaoshi.230.5","","","H46896572");var i=o(t.target);e.trigger("itemTap",{id:i.attr("data-id"),el:t.target,$el:i,hasChild:i.attr("data-hasChild")=="true",cityName:i.text()})}).on("touchend",".cities, .hot-cities-column",function(e){e.preventDefault()});this.cover.$el.on("tap",".delivery-address .address",function(t){t.preventDefault();window.goldlog&&window.goldlog.record("/tbchaoshi.230.4","","","H46896571");var i=o(t.target);e.trigger("deliveryTap",{id:i.attr("data-id"),el:t.target,$el:i})}).on("touchend",".delivery-address .address",function(e){e.preventDefault()});return this}},{key:"showDivisionChild",value:function m(t){var i=this;s.getInstance().show();e(["mui/city-selector/divisionchild.xtpl"],function(e){if(i.$divisionchildEl&&i.$divisionchildEl.length>0){s.getInstance().hide();return}i.$divisionchildEl=o(e(t));i.cover.$el.append(i.$divisionchildEl);setTimeout(function(){s.getInstance().hide();i.$divisionchildEl.find(".tab").removeClass("bounceInUp animated")},500);var n=i.config.touchstart||function(e){if(["INPUT","TEXTAREA","BUTTON","SELECT","A"].indexOf(e.target.nodeName)===-1){e.preventDefault()}};var r=i.$divisionchildEl.find(".list");var u;r.on("touchstart",function(e){u=e.touches[0].pageY}).on("touchmove",function(e){var t=e.touches[0].pageY;var i=r[0];if(t-u>0&&i.scrollTop===0){n(e)}else if(t-u<0&&i.scrollTop+r.height()===i.scrollHeight){n(e)}})});return this}},{key:"bindDivisionChild",value:function f(){var e=this;this.cover.$el.on("tap",".close",function(t){e.$divisionchildEl&&e.$divisionchildEl.remove();delete e.$divisionchildEl}).on("touchend",".close",function(e){e.preventDefault()});this.cover.$el.on("tap","#division-child .item",function(t){t.preventDefault();var i=o(t.target);e.trigger("divisionChildTap",{id:i.attr("data-id"),el:t.target,$el:i,cityName:i.text()})}).on("touchend","#division-child .item",function(e){e.preventDefault()});return this}},{key:"bindNav",value:function h(){var e=this;var t=this.cover.$el;var i=t.find(".notice");var n=function a(e){var t=e.innerText;if(t==="\u70ed\u95e8\u57ce\u5e02"){return"\u70ed"}else{return t}};var r=function(e){t.find(".body")[0].scrollTop=this.getOffsetTop(e);i.css("opacity",1).text(n(e))}.bind(this);var o=t.find(".letters-column");var u=function c(){o.each(function(e,t){t._top=t.offsetTop;t._bottom=t._top+t.scrollHeight})};u();this.cover.on("show",function(){u()});window.addEventListener("orientationchange",function(){setTimeout(function(){u()},200)});t.find(".all-letters .list").on("touchstart",".letters-column",function(e){e.preventDefault();i.css("opacity",1).text(n(e.currentTarget))}).on("touchmove",function(e){e.preventDefault();var i=e.touches[0].pageY-(window.pageYOffset||window.scrollY);var n;o.each(function(e,r){if(i>=r._top&&i<=r._bottom){n=t.find(".J_letter_"+r.getAttribute("data-idx"))[0]}});if(n){r(n)}}).on("touchend",function(){setTimeout(function(){i.css("opacity",0)},50)});t.find(".all-letters").on("tap",".letters-column",function(t){t.preventDefault();var i=t.target.getAttribute("data-idx");var n=e.cover.$el.find(".J_letter_"+i)[0];r(n)})}},{key:"getData",value:function g(){var e=this;return new Promise(function(t,i){if(e.data){return t(e.data)}else{e.once("dataChange",function(){t(e.data)})}})}},{key:"getOffsetTop",value:function p(e){var t=0;do{if(!isNaN(e.offsetTop)){t+=e.offsetTop}}while(e=e.offsetParent);var i=this.diff;return t-i}},{key:"show",value:function v(){this.cover.show();return this}},{key:"hide",value:function y(){this.cover.hide();return this}},{key:"destroy",value:function b(){this.cover.destroy()}},{key:"data",get:function x(){return this._data},set:function w(e){this._data=e;this.trigger("dataChange");return e}},{key:"currentCity",get:function z(){return this._currentCity},set:function C(e){this._currentCity=e;this.trigger("currentCityChange");return e}}]);return t}();i.exports=m;Object.assign(m.prototype,l)});