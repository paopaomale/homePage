define("mui/searchbar-m/index",function(t,e,i){"use strict";var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(t,a.key,a)}}return function(e,i,a){if(i)t(e.prototype,i);if(a)t(e,a);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}t("mui/searchbar-m/index.css");var s=t("mui/zepto/zepto");t("mui/zepto/event");t("mui/zepto/form");var o=t("mui/fetch/jsonp");var c=t("mui/searchbar-m/lib/index");var h=t("mui/searchbar-m/lib/atp");var u=t("mui/searchbar-m/plugin/template");var l=t("mui/searchbar-m/plugin/hotquery");var f=t("mui/searchbar-m/plugin/native");var m=function(){function t(){r(this,t);this.isInit=false;this.$template=new u;this.$hotquery=new l;this.$input=null;this.$form=null;this.$cancelBtn=null;this.$contentDiv=null}n(t,[{key:"init",value:function e(t){if(this.isInit){return}this.isInit=true;this._initCfg(t||{});if(this.$cfg.isOpenNative&&f.isSupportNative(this.$cfg.dim,this.$cfg)){this.$cfg.isSupportNative=true;this.nativeCfg={dim:this.$cfg.dim,nativeCfg:{searchType:this.$cfg.searchType},sugArea:this.$cfg.sugArea,extraParams:this.$cfg.extraParams,isSupportNative:true};return}this._initDOM();this._initEvent();h.initLog(this.$cfg)}},{key:"show",value:function i(){if(this.isInit){if(this.nativeCfg&&this.nativeCfg.isSupportNative){f.showNative(this.nativeCfg);return}s("#J_PopSearch").show()}else{this.init()}}},{key:"set",value:function m(t){var e=this.$cfg.q||"";this.$cfg=Object.assign(this.$cfg,t);this.sughotHandler();if(e!=this.$cfg.q){if(this.$input){this.$input.val(this.$cfg.q||"")}}}},{key:"_initCfg",value:function p(t){t.sugArea=t.sugArea||"b2c";t.dim=t.dim||"mallfp..m";this.$cfg=Object.assign({actionUrl:"//s.m.tmall.com/m/search.htm",sugUrl:"//suggest.taobao.com/sug?area="+t.sugArea+"&code=utf-8&k=1&src=tmall_h5",dim:t.dim,hotUrl:"//suggest.taobao.com/sug?area=tmall-hq&code=utf-8&src="+t.dim,tmhkh5:t.tmhkh5||"",isOpenNative:true,searchType:"",extraParams:null},t);this.$template.config(["banner","list"])}},{key:"_initDOM",value:function v(){var t=['<div id="J_PopSearch" class="searchbox" style="display: none;"><div class="sb-search">','<div class="sb-search">','<form action="'+this.$cfg.actionUrl+'" accept-charset="gbk" target="_self">','<input type="search" id="mq" name="q" value="" title="\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57" accesskey="s" x-webkit-speech x-webkit-grammar="builtin:translate" autocomplete="off" />','<input type="submit" title="\u63d0\u4ea4">','<input type="reset" class="j_PopSearchClear" title="\u91cd\u7f6e\u641c\u7d22\u8bcd"/>',"</form>",'<button class="close j_CloseSearchBox"></button>',"</div>","</div>",'<div class="sb-content">',"</div>","</div>"];s(t.join("\n")).appendTo("body");this.$input=s("#J_PopSearch input[type=search]");var e=this.$cfg.q||"";this.$input.val(e);this.$form=s("#J_PopSearch form");this.$submitBtn=s("#J_PopSearch input[type=submit]");this.$cancelBtn=s("#J_PopSearch input[type=reset]");this.$contentDiv=s("#J_PopSearch div.sb-content")}},{key:"_initEvent",value:function g(){var t=this;this.sughotHandler();t.$input.on("keydown",function(e){t.keyboardHandler(e)});t.$input.on("input",function(e){t.$cfg.q=s(this).val()||"";t.sughotHandler()});t.$submitBtn.on("click tap",function(){t.inputSearchHandler()});this.cancelBtnHandler();this.formHandler();this.contentHandler();this.closeHandler()}},{key:"sughotHandler",value:function d(){this.cancelBtnDisplayHandler(!!this.$cfg.q);if(this.$cfg.q){this.getSuggestData(this.renderSuggest)}else{this.getHotData(this.renderHot)}}},{key:"getSuggestData",value:function $(t){var e=this;o(this.$cfg.sugUrl+"&q="+this.$cfg.q,{method:"jsonp"}).then(function(t){return t.json()}).then(function(i){t.apply(e,[i])}).catch(function(i){t.apply(e,[{}])})}},{key:"getHotData",value:function y(t){var e=this;if(!this.$cfg.hotData){o(this.$cfg.hotUrl,{method:"jsonp"}).then(function(t){return t.json()}).then(function(i){e.$cfg.hotData=i;t.apply(e)}).catch(function(t){})}else{t.apply(e)}}},{key:"renderSuggest",value:function b(t){var e=this.$template.parse(t,this.$cfg);this.$contentDiv.html(e.join(""))}},{key:"renderHot",value:function k(){var t=this;this.renderPlaceholder();t.$hotquery.render({data:t.$cfg.hotData,container:t.$contentDiv},t.$cfg)}},{key:"renderPlaceholder",value:function S(){var t=this.$cfg.hotData&&this.$cfg.hotData.model&&this.$cfg.hotData.model.placeholder||[];this.$input.attr("placeholder",t[0].text);this.$input.val("");this.$cfg.q=(t[0]||{}).q}},{key:"keyboardHandler",value:function q(t){var e=this;switch(t.keyCode){case 13:{t.preventDefault();e.inputSearchHandler()}break;case 38:break;case 40:break;default:break}}},{key:"cancelBtnHandler",value:function _(){var t=this;this.$cancelBtn&&this.$cancelBtn.on("click tap",function(e){t.$cfg.q="";t.$input.val(t.$cfg.q);t.cancelBtnDisplayHandler(false);t.sughotHandler()})}},{key:"cancelBtnDisplayHandler",value:function D(t){var e="#J_PopSearch .j_PopSearchClear";t?s(e).show():s(e).hide()}},{key:"formHandler",value:function H(){var t=this;t.$form.on("submit",function(t){return true})}},{key:"contentHandler",value:function P(){var t=this;var e=this;s(e.$contentDiv).on("click tap","div.s-mi-hq",function(i){var a=s(i.currentTarget).data("q")||"";var n=s(i.currentTarget).data("params")||"";n=c.unparam(n)||{};var r={q:a,type:n.type,tmhkh5:t.$cfg.tmhkh5||"",spm:n.spm,from:n.from};e.$cancelBtn.show();e.modifyForm(r);e.submitForm("hq")});s(e.$contentDiv).on("click tap","div.s-mi-list",function(i){var a=s(i.currentTarget).data("q")||"";var n=s(i.currentTarget).data("params")||"";n=c.unparam(n)||{};var r={q:a,type:n.type,tmhkh5:t.$cfg.tmhkh5||"",spm:n.spm,from:n.from};e.modifyForm(r);e.submitForm("suggest")})}},{key:"closeHandler",value:function j(){s("#J_PopSearch .j_CloseSearchBox").on("click",function(t){s("#J_PopSearch").hide()})}},{key:"inputSearchHandler",value:function x(){var t=this;var e=s.trim(t.$input.val()||"");var i=c.getSpmId("a2227oh.d100")||"";if(e===""){var a={};if(this.$cfg&&this.$cfg.hotData&&this.$cfg.hotData.model){a=this.$cfg.hotData.model.placeholder||[];a=a[0]||{}}var n={q:a.query,type:"p",tmhkh5:this.$cfg.tmhkh5||"",spm:i,from:this.$cfg.dim+"_1_placeholder"};this.$cancelBtn.show();this.modifyForm(n)}else{var r={q:e,type:"p",tmhkh5:this.$cfg.tmhkh5||"",spm:i,from:this.$cfg.dim+"_1_searchbutton"};this.modifyForm(r)}t.submitForm("enter")}},{key:"modifyForm",value:function w(t){var e=this;var i=[];e.$form.find("input.other-params").remove();for(var n in t){if(n==="q"){e.$input.val(t[n])}else{i.push(['<input class="other-params" type="hidden" name=',n,' value="',t[n],'">'].join(""))}}if(this.$cfg.extraParams&&a(this.$cfg.extraParams)=="object"){var r=this.$cfg.extraParams;for(var o in r){i.push(['<input class="other-params" type="hidden" name=',o,' value="',r[o],'">'].join(""))}}s(e.$form).append(i.join(""))}},{key:"submitForm",value:function B(t){var e=this;s(e.$form).submit()}},{key:"on",value:function C(t,e){var i=this._events[t]||(this._events[t]=[]);if(i.indexOf(e)!=-1){return this}i.push(e);return this}},{key:"fire",value:function J(t){for(var e=arguments.length,i=Array(e>1?e-1:0),a=1;a<e;a++){i[a-1]=arguments[a]}var n=this._events[t];if(!n||!n.length){return false}n.forEach(function(t){return t.apply(null,i)});return true}}]);return t}();i.exports=m});