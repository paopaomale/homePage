function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw u}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();!function(){function e(){for(var e=0,n=new Array(256),t=0;256!==t;++t){e=t;for(var r=8;r--;)e=1&e?-306674912^e>>>1:e>>>1;n[t]=e}return"undefined"!=typeof Int32Array?new Int32Array(n):n}function n(e){for(var n,t,r=-1,o=0,u=e.length;o<u;)n=e.charCodeAt(o++),n<128?r=r>>>8^h[255&(r^n)]:n<2048?(r=r>>>8^h[255&(r^(192|n>>6&31))],r=r>>>8^h[255&(r^(128|63&n))]):n>=55296&&n<57344?(n=(1023&n)+64,t=1023&e.charCodeAt(o++),r=r>>>8^h[255&(r^(240|n>>8&7))],r=r>>>8^h[255&(r^(128|n>>2&63))],r=r>>>8^h[255&(r^(128|t>>6&15|(3&n)<<4))],r=r>>>8^h[255&(r^(128|63&t))]):(r=r>>>8^h[255&(r^(224|n>>12&15))],r=r>>>8^h[255&(r^(128|n>>6&63))],r=r>>>8^h[255&(r^(128|63&n))]);return r^-1}var t=window.interval_before_onload||5e3,r=window.interval_after_onload||2500,o=!!(window.localStorage&&window.localStorage.setItem&&window.localStorage.getItem),u=1900,i="//gm.mmstat.com/codetrack.1.1",a="//gm.mmstat.com/codetrack.1.2",l="//gm.mmstat.com/codetrack.1.3",s=encodeURIComponent,c=function(e,n){for(var t in e)e.hasOwnProperty(t)&&n.call(e,e[t],t)},f=+new Date,h=e(),d=function(){function e(n){var t=this,r=n.name,u=void 0===r?"none":r,a=n.sender,l=void 0===a?function(){return[]}:a,s=n.api,c=void 0===s?i:s;_classCallCheck(this,e),this.isDebug=this.isDebugMode(),this.gid=0,this.name=u,this.api=c,this.windowOnLoaded=!1,this.queueName=u+"_queue",this.fullQueueName=u+"_full_queue",this.listenWindowOnload(),this.startSendPool(),this.setQueue(window[this.queueName]||[]),this.setFullQueue([].concat(_toConsumableArray(o?JSON.parse(window.localStorage.getItem(this.fullQueueName))||[]:[]),_toConsumableArray(window[this.fullQueueName]||[]))),window[u+"Track"]=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return l.apply(t,n)}}return _createClass(e,[{key:"convertToString",value:function(e){return e.map(function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?JSON.stringify(e):null===e||void 0===e?"":e+""})}},{key:"push",value:function(e){this.queue.push(e)}},{key:"pushFull",value:function(e){this.fullQueue.push(e)}},{key:"setQueue",value:function(e){window[this.queueName]=this.queue=e}},{key:"setFullQueue",value:function(e){window[this.fullQueueName]=this.fullQueue=e,o&&window.localStorage.setItem(this.fullQueueName,JSON.stringify(e))}},{key:"listenWindowOnload",value:function(){var e=this,n=function n(){e.windowOnLoaded=!0,window.removeEventListener("load",n,!1)};window.addEventListener("load",n,!1)}},{key:"isDebugMode",value:function(){return"true"===(window.location.search||"").slice(1).split("&").reduce(function(e,n){var t=n.split("="),r=_slicedToArray(t,2),o=r[0],u=r[1];return o&&u?(e[o]=u,e):e},{}).ctk}},{key:"startSendPool",value:function(){var e=this;setTimeout(function(){e.setQueue(e.formatQueue(e.queue)),e.setFullQueue(e.formatQueue(e.fullQueue)),e.sendNormalQueue(),e.sendFullQueue(),e.startSendPool()},this.windowOnLoad?r:t)}},{key:"formatQueue",value:function(e){return e.map(function(e){return Array.isArray(e)?{length:1,point:e}:e})}},{key:"sendNormalQueue",value:function(){var e=this,n=[];c(this.queue.reduce(function(e,n){var t=_slicedToArray(n.point,1),r=t[0];return e[r]=e[r]||{point:null,length:0},e[r].point=n.point,e[r].length+=n.length,e},{}),function(e){return n.push(e)});var t=[],r=0;n=n.sort(function(){return Math.random()-.5});for(var o=n.length;o--;){var i=s([].concat(_toConsumableArray(n[o].point),[1e3]).map(function(e){return(e+"").replace("|","\uff5c")}).map(function(e){return(e+"").replace(";","\uff1b")}).join("|")).length;if(r+i>u)break;t.push(n[o]),r+=i}this.send(t.map(function(r){return e.convertToString([].concat(_toConsumableArray(r.point),[r.length*Math.round(n.length/t.length)])).join("|")}).join(";")),this.setQueue([])}},{key:"sendFullQueue",value:function(){var e=this,n=[];c(this.fullQueue.reduce(function(e,n){var t=_slicedToArray(n.point,1),r=t[0];return e[r]=e[r]||{point:null,length:0},e[r].point=n.point,e[r].length+=n.length,e},{}),function(e){return n.push(e)}),this.setFullQueue(n);for(var t=[],r=0;n.length;){var o=n[0],i=s(o.point.map(function(e){return(e+"").replace("|","\uff5c")}).map(function(e){return(e+"").replace(";","\uff1b")}).join("|")).length;if(r+i>u)break;t.push(n.shift()),r+=i}this.send(t.map(function(n){return e.convertToString([].concat(_toConsumableArray(n.point),[n.length])).join("|")}).join(";"))}},{key:"send",value:function(e){if(e){var t="__CT_image_"+this.gid++,r=window[t]=new Image;r.onload=r.onerror=function(){return window[t]=null},r.src=this.api+"?msg="+s(e)+"&hash="+n(e)}}}]),e}(),m="",p={};new d({name:"spy",sender:function(e){var n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],t=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];e&&(t?this.pushFull([e,n,+new Date-f]):this.push([e,n,+new Date-f]))},api:a}),new d({name:"tes",api:l,sender:function(e){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],t=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];e&&(t?this.pushFull([e].concat(_toConsumableArray(n))):this.push([e].concat(_toConsumableArray(n))))}}),new d({name:"ctk",sender:function(e){var n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],t=arguments[2],r=t.module,o=void 0===r?"":r,u=t.type,i=void 0===u?"normal":u,a=t.msg,l=void 0===a?"":a,s=t.version,c=void 0===s?"":s;if(e){m||(m=e);var f=+new Date;p[e]=f;var h=e===m?0:f-(p[n||m]||p[m]);"error"===i?this.pushFull([e,n,o,c,l,Math.max(h,0),1]):this.push([e,n,o,c,l,Math.max(h,0),0])}},api:i})}();