define("mui/zebra-task-main/omission",function(a,t,e){var i=a("mui/zepto/zepto");a("mui/zepto/event");var o=a("mui/zebra-task-main/server");var n=a("mui/zebra-task-main/util");var s=n.getParam;var r=n.concatUrl;var l=a("mui/zebra-task-main/report");var d=l.report;var c=a("mui/zebra-task-main/pop");var p=c.showCommonBox;var u=c.showAuth;var m=c.showErrorBox;var f=c.showNotSupportBox;var v=i(".zebra-task-main");var g=i("meta[name='spm-id']").attr("content");var w=0;var h=1;var k=0;var b="";var y=0;var x={init:function C(a){var t=a.officialMission;var e=0;if(t&&t.length){e=t.length}i(".official-list-container",v).show();i(".old-task-wrap",v).remove();if(!e){i(".bg-red,.task-official-wrap,.official-list-container",v).hide()}else{i(".official-mission-container").show()}this.parse(t);this.bindEvent();this.updateVal(a);try{var o=i(".item-omission-inner",v);for(var n=0;n<o.length;n++){var s=i(o[n]).attr("data-gotoUrl");if(s&&s.indexOf("tmall://page.tm/myStreet")===0){if(window.lib&&lib.env&&lib.env.aliapp&&lib.env.aliapp.version.lt("5.13.0")){i(".omission-title",o[n]).html("\u6d4f\u89c8\u8d62\u5b9d\u7bb1");i(".omission-entry",o[n]).html("\u8fdb\u5165\u5173\u6ce8\u9996\u9875");i(".omission-howtodo",o[n]).html("\u6d4f\u89c810\u5f20\u5361\u7247\u5185\u5bb9")}}}}catch(r){}},parse:function I(a){for(var t=0;a&&t<a.length;t++){var e=a[t];var o=e.id;var n=i('.item-omission-inner[data-id="'+o+'"]');if(n.length){n.attr("data-lotteryId",e.lotteryId);n.attr("data-userTaskId",e.userTaskId)}}this.update(a)},bindEvent:function X(){i(".btn-omission-wrap").on("click",function(a){var t=i(".omission-list-wrap li.hide",i(this).closest(".omission-wrap"));var e=20;t.each(function(a,t){if(a<e){i(t).removeClass("hide")}});if(t.length<e){i(this).remove()}});i("ul.omission-list-wrap",v).on("click",".item-omission-inner",function(a){var t=i(this);var e=t;var n=t.attr("data-lotteryId");var s=t.attr("data-gotoUrl").replace("taskId=xxx","");var l=t.attr("data-id");var p=t.attr("data-userTaskId");var m=t.attr("data-status");var k=t.attr("data-compType");var b={taskStatus:m,wh_taskStatus:m,wh_taskId:l,spm:g+".mcity."+l+"."+window.g_aplus_pv_id};if(t.attr("data-act")==618){b.missionId=l;try{localStorage.setItem("mcity-task-id",l)}catch(a){console.log("setItem mcity-task-id error")}}else{b.taskId=l;if(!Ali.isTmall){return c.showCommonBox(".pop-not-tmall",v)}try{localStorage.removeItem("mcity-task-id")}catch(a){console.log("removeItem mcity-task-id error")}}s=r(s,b);if(s.indexOf("tmall://page.tm/myStreet")===0){if(!f(v,"5.10.0")){return}}var y=function x(){if(m==0||m==10){if(i(e).attr("data-checking")){return}i(e).attr("data-checking");o.assign({taskType:2,id:l,api:t.attr("data-act")=="618"?"mtop.tmw.mcity.assignactivitytask":"mtop.tmw.mcity.assign"},function(a){if(a&&a.data){Ali.pushWindow(s)}else{Ali.toast("\u9886\u53d6\u4efb\u52a1\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}i(e).removeAttr("data-checking")})}else{Ali.pushWindow(s)}};if(w){if(h){y()}else{return u(v)}}else{Ali.login(function(a){if(a.errorCode){Ali.toast("\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}else{setTimeout(y,100)}i(e).removeAttr("data-checking")})}d("/uaward.20150922.3","","taskid="+l,"H46956152")})},update:function T(a){if(a){for(var t=0;t<a.length;t++){var e=a[t];var o=i(".item-omission-inner[data-id='"+e.id+"']");var n=o.attr("data-status");var s=o.attr("data-id");if(e.id==s&&e.status!=n){var r="";var l="graybg";switch(parseInt(e.status,10)){case 11:case 12:r="\u4efb\u52a1\u5df2\u9886\u53d6";l="otask-assigned";break;case 13:r="\u4efb\u52a1\u5df2\u5b8c\u6210";break;case 22:r="\u4efb\u52a1\u5df2\u8fc7\u671f";break;case 23:r="\u4efb\u52a1\u5df2\u653e\u5f03";break;case 30:case 31:r="\u4efb\u52a1\u88ab\u62a2\u7206";break;default:l="";break}if(r){i(".omission-right-wrap span",o).text(r);if(l){i(".omission-right-wrap",o).addClass(l)}}o.attr("data-status",e.status)}}}},updateVal:function M(a){w=""+a.isLogin=="true";h=""+a.alipayCertified=="true";k=""+a.securityCheck=="true";sigTokent=a.sigTokent;b=a.sigSessionId}};e.exports=x});